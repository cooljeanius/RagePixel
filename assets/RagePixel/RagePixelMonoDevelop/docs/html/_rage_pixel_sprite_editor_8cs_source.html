<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>RagePixel: assets/RagePixel/RagePixelMonoDevelop/editor/RagePixelSpriteEditor.cs Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">RagePixel
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">assets/RagePixel/RagePixelMonoDevelop/editor/RagePixelSpriteEditor.cs</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="keyword">using</span> UnityEngine;
<a name="l00002"></a>00002 <span class="keyword">using</span> UnityEditor;
<a name="l00003"></a>00003 <span class="keyword">using</span> System;
<a name="l00004"></a>00004 <span class="keyword">using</span> System.Collections;
<a name="l00005"></a>00005 <span class="keyword">using</span> System.Collections.Generic;
<a name="l00006"></a>00006 <span class="keyword">using</span> System.IO;
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 [CustomEditor(typeof(<a class="code" href="class_rage_pixel_sprite.html">RagePixelSprite</a>))]
<a name="l00009"></a><a class="code" href="class_rage_pixel_sprite_editor.html">00009</a> <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="class_rage_pixel_sprite_editor.html">RagePixelSpriteEditor</a> : Editor
<a name="l00010"></a>00010 {
<a name="l00011"></a>00011         <span class="keyword">private</span> <span class="keywordtype">float</span> handleSize = 0.01f;
<a name="l00012"></a>00012         <span class="keyword">private</span> <span class="keywordtype">bool</span> justSelected = <span class="keyword">false</span>;
<a name="l00013"></a>00013         <span class="keyword">private</span> <span class="keywordtype">bool</span> paintUndoSaved = <span class="keyword">false</span>;
<a name="l00014"></a>00014         <span class="keyword">private</span> <span class="keywordtype">int</span> defaultSceneButtonWidth = 32;
<a name="l00015"></a>00015         <span class="keyword">private</span> <span class="keywordtype">int</span> defaultSceneButtonHeight = 32;
<a name="l00016"></a>00016         <span class="keyword">private</span> <span class="keywordtype">bool</span> atlasTextureIsDirty = <span class="keyword">false</span>;
<a name="l00017"></a>00017         <span class="keyword">private</span> Color32[] colorReplaceBuffer;
<a name="l00018"></a>00018         <span class="keyword">private</span> <a class="code" href="class_rage_pixel_texel_rect.html">RagePixelTexelRect</a> selection;
<a name="l00019"></a>00019         <span class="keyword">private</span> <span class="keywordtype">bool</span> selectionActive = <span class="keyword">false</span>;
<a name="l00020"></a>00020         <span class="keyword">private</span> <a class="code" href="class_rage_pixel_texel.html">RagePixelTexel</a> selectionStart;
<a name="l00021"></a>00021         <span class="keyword">private</span> <a class="code" href="class_rage_pixel_texel.html">RagePixelTexel</a> frontBufferPosition;
<a name="l00022"></a>00022         <span class="keyword">private</span> <a class="code" href="class_rage_pixel_texel.html">RagePixelTexel</a> frontBufferDragStartPosition;
<a name="l00023"></a>00023         <span class="keyword">private</span> <a class="code" href="class_rage_pixel_texel.html">RagePixelTexel</a> frontBufferDragStartMousePosition;
<a name="l00024"></a>00024         <span class="keyword">private</span> <a class="code" href="class_rage_pixel_bitmap.html">RagePixelBitmap</a> backBuffer;
<a name="l00025"></a>00025         <span class="keyword">private</span> <a class="code" href="class_rage_pixel_bitmap.html">RagePixelBitmap</a> frontBuffer;
<a name="l00026"></a>00026 
<a name="l00027"></a>00027         <span class="keyword">public</span> <span class="keyword">enum</span> Mode
<a name="l00028"></a>00028         {
<a name="l00029"></a>00029                 Default = 0,
<a name="l00030"></a>00030                 Pen,
<a name="l00031"></a>00031                 Fill,
<a name="l00032"></a>00032                 Scale,
<a name="l00033"></a>00033                 Resize,
<a name="l00034"></a>00034                 Select
<a name="l00035"></a>00035         };
<a name="l00036"></a>00036         <span class="keyword">public</span> Mode mode = Mode.Default;
<a name="l00037"></a>00037         <span class="keyword">public</span> Vector2 rectangleStart;
<a name="l00038"></a>00038         <span class="keyword">protected</span> <span class="keywordtype">bool</span> animationStripEnabled = <span class="keyword">true</span>;
<a name="l00039"></a>00039         <span class="keyword">public</span> <span class="keyword">enum</span> BrushType
<a name="l00040"></a>00040         {
<a name="l00041"></a>00041                 Brush1 = 0,
<a name="l00042"></a>00042                 Brush3,
<a name="l00043"></a>00043                 Brush5
<a name="l00044"></a>00044         };
<a name="l00045"></a>00045         <span class="keyword">public</span> BrushType brushType = BrushType.Brush1;
<a name="l00046"></a>00046         <span class="keyword">private</span> <a class="code" href="class_rage_pixel_bitmap.html">RagePixelBitmap</a> _brush11;
<a name="l00047"></a>00047         <span class="keyword">private</span> <a class="code" href="class_rage_pixel_bitmap.html">RagePixelBitmap</a> _brush33;
<a name="l00048"></a>00048         <span class="keyword">private</span> <a class="code" href="class_rage_pixel_bitmap.html">RagePixelBitmap</a> _brush55;
<a name="l00049"></a>00049 
<a name="l00050"></a>00050         <span class="keyword">public</span> <a class="code" href="class_rage_pixel_bitmap.html">RagePixelBitmap</a> brush
<a name="l00051"></a>00051         {
<a name="l00052"></a>00052                 <span class="keyword">get</span>
<a name="l00053"></a>00053                 {
<a name="l00054"></a>00054                         <span class="keywordflow">switch</span>(brushType)
<a name="l00055"></a>00055                         {
<a name="l00056"></a>00056                         <span class="keywordflow">case</span> (BrushType.Brush1):
<a name="l00057"></a>00057                                 <span class="keywordflow">if</span>(_brush11 == null)
<a name="l00058"></a>00058                                 {
<a name="l00059"></a>00059                                         Color[] brush;
<a name="l00060"></a>00060                                         brush = <span class="keyword">new</span> Color[1];
<a name="l00061"></a>00061                                         brush[0] = <span class="keyword">new</span> Color(1f, 1f, 1f, 1f); 
<a name="l00062"></a>00062                                         _brush11 = <span class="keyword">new</span> <a class="code" href="class_rage_pixel_bitmap.html">RagePixelBitmap</a>(brush, 1, 1);
<a name="l00063"></a>00063                                 }
<a name="l00064"></a>00064                                 <span class="keywordflow">return</span> _brush11;
<a name="l00065"></a>00065 
<a name="l00066"></a>00066                         <span class="keywordflow">case</span> (BrushType.Brush3):
<a name="l00067"></a>00067                                 <span class="keywordflow">if</span>(_brush33 == null)
<a name="l00068"></a>00068                                 {
<a name="l00069"></a>00069                                         Color[] brush;
<a name="l00070"></a>00070                                         brush = <span class="keyword">new</span> Color[3 * 3];
<a name="l00071"></a>00071                                         brush[0] = <span class="keyword">new</span> Color(1f, 1f, 1f, 0f);
<a name="l00072"></a>00072                                         brush[1] = <span class="keyword">new</span> Color(1f, 1f, 1f, 1f);
<a name="l00073"></a>00073                                         brush[2] = <span class="keyword">new</span> Color(1f, 1f, 1f, 0f);
<a name="l00074"></a>00074                                         brush[3] = <span class="keyword">new</span> Color(1f, 1f, 1f, 1f);
<a name="l00075"></a>00075                                         brush[4] = <span class="keyword">new</span> Color(1f, 1f, 1f, 1f);
<a name="l00076"></a>00076                                         brush[5] = <span class="keyword">new</span> Color(1f, 1f, 1f, 1f);
<a name="l00077"></a>00077                                         brush[6] = <span class="keyword">new</span> Color(1f, 1f, 1f, 0f);
<a name="l00078"></a>00078                                         brush[7] = <span class="keyword">new</span> Color(1f, 1f, 1f, 1f);
<a name="l00079"></a>00079                                         brush[8] = <span class="keyword">new</span> Color(1f, 1f, 1f, 0f);
<a name="l00080"></a>00080                                         _brush33 = <span class="keyword">new</span> <a class="code" href="class_rage_pixel_bitmap.html">RagePixelBitmap</a>(brush, 3, 3);
<a name="l00081"></a>00081                                 }
<a name="l00082"></a>00082                                 <span class="keywordflow">return</span> _brush33;
<a name="l00083"></a>00083 
<a name="l00084"></a>00084                         <span class="keywordflow">case</span> (BrushType.Brush5):
<a name="l00085"></a>00085                                 <span class="keywordflow">if</span>(_brush55 == null)
<a name="l00086"></a>00086                                 {
<a name="l00087"></a>00087                                         Color[] brush;
<a name="l00088"></a>00088                                         brush = <span class="keyword">new</span> Color[5 * 5];
<a name="l00089"></a>00089                                         brush[0] = <span class="keyword">new</span> Color(1f, 1f, 1f, 0f);
<a name="l00090"></a>00090                                         brush[1] = <span class="keyword">new</span> Color(1f, 1f, 1f, 1f);
<a name="l00091"></a>00091                                         brush[2] = <span class="keyword">new</span> Color(1f, 1f, 1f, 1f);
<a name="l00092"></a>00092                                         brush[3] = <span class="keyword">new</span> Color(1f, 1f, 1f, 1f);
<a name="l00093"></a>00093                                         brush[4] = <span class="keyword">new</span> Color(1f, 1f, 1f, 0f);
<a name="l00094"></a>00094                                         brush[5] = <span class="keyword">new</span> Color(1f, 1f, 1f, 1f);
<a name="l00095"></a>00095                                         brush[6] = <span class="keyword">new</span> Color(1f, 1f, 1f, 1f);
<a name="l00096"></a>00096                                         brush[7] = <span class="keyword">new</span> Color(1f, 1f, 1f, 1f);
<a name="l00097"></a>00097                                         brush[8] = <span class="keyword">new</span> Color(1f, 1f, 1f, 1f);
<a name="l00098"></a>00098                                         brush[9] = <span class="keyword">new</span> Color(1f, 1f, 1f, 1f);
<a name="l00099"></a>00099                                         brush[10] = <span class="keyword">new</span> Color(1f, 1f, 1f, 1f);
<a name="l00100"></a>00100                                         brush[11] = <span class="keyword">new</span> Color(1f, 1f, 1f, 1f);
<a name="l00101"></a>00101                                         brush[12] = <span class="keyword">new</span> Color(1f, 1f, 1f, 1f);
<a name="l00102"></a>00102                                         brush[13] = <span class="keyword">new</span> Color(1f, 1f, 1f, 1f);
<a name="l00103"></a>00103                                         brush[14] = <span class="keyword">new</span> Color(1f, 1f, 1f, 1f);
<a name="l00104"></a>00104                                         brush[15] = <span class="keyword">new</span> Color(1f, 1f, 1f, 1f);
<a name="l00105"></a>00105                                         brush[16] = <span class="keyword">new</span> Color(1f, 1f, 1f, 1f);
<a name="l00106"></a>00106                                         brush[17] = <span class="keyword">new</span> Color(1f, 1f, 1f, 1f);
<a name="l00107"></a>00107                                         brush[18] = <span class="keyword">new</span> Color(1f, 1f, 1f, 1f);
<a name="l00108"></a>00108                                         brush[19] = <span class="keyword">new</span> Color(1f, 1f, 1f, 1f);
<a name="l00109"></a>00109                                         brush[20] = <span class="keyword">new</span> Color(1f, 1f, 1f, 0f);
<a name="l00110"></a>00110                                         brush[21] = <span class="keyword">new</span> Color(1f, 1f, 1f, 1f);
<a name="l00111"></a>00111                                         brush[22] = <span class="keyword">new</span> Color(1f, 1f, 1f, 1f);
<a name="l00112"></a>00112                                         brush[23] = <span class="keyword">new</span> Color(1f, 1f, 1f, 1f);
<a name="l00113"></a>00113                                         brush[24] = <span class="keyword">new</span> Color(1f, 1f, 1f, 0f);
<a name="l00114"></a>00114                                         _brush55 = <span class="keyword">new</span> <a class="code" href="class_rage_pixel_bitmap.html">RagePixelBitmap</a>(brush, 5, 5);
<a name="l00115"></a>00115                                 }
<a name="l00116"></a>00116                                 <span class="keywordflow">return</span> _brush55;
<a name="l00117"></a>00117                         }
<a name="l00118"></a>00118                         <span class="keywordflow">return</span> null;
<a name="l00119"></a>00119                 }       
<a name="l00120"></a>00120         }
<a name="l00121"></a>00121 
<a name="l00122"></a>00122         <span class="keyword">private</span> Camera sceneCamera
<a name="l00123"></a>00123         {
<a name="l00124"></a>00124                 <span class="keyword">get</span>
<a name="l00125"></a>00125                 {
<a name="l00126"></a>00126                         <span class="keywordflow">if</span>(SceneView.lastActiveSceneView != null)
<a name="l00127"></a>00127                         {
<a name="l00128"></a>00128                                 <span class="keywordflow">return</span> SceneView.lastActiveSceneView.camera;
<a name="l00129"></a>00129                         }
<a name="l00130"></a>00130                         <span class="keywordflow">else</span>
<a name="l00131"></a>00131                         {
<a name="l00132"></a>00132                                 <span class="keywordflow">return</span> null;
<a name="l00133"></a>00133                         }
<a name="l00134"></a>00134 
<a name="l00135"></a>00135                 }
<a name="l00136"></a>00136         }
<a name="l00137"></a>00137 
<a name="l00138"></a>00138         <span class="keyword">private</span> <span class="keywordtype">int</span> scenePixelWidth
<a name="l00139"></a>00139         {
<a name="l00140"></a>00140                 <span class="keyword">get</span>
<a name="l00141"></a>00141                 {
<a name="l00142"></a>00142                         <span class="keywordflow">if</span>(sceneCamera != null)
<a name="l00143"></a>00143                         {
<a name="l00144"></a>00144                                 <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)sceneCamera.pixelWidth;
<a name="l00145"></a>00145                         }
<a name="l00146"></a>00146                         <span class="keywordflow">else</span>
<a name="l00147"></a>00147                         {
<a name="l00148"></a>00148                                 <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)Screen.width;
<a name="l00149"></a>00149                         }
<a name="l00150"></a>00150                 }
<a name="l00151"></a>00151         }
<a name="l00152"></a>00152 
<a name="l00153"></a>00153         <span class="keyword">private</span> <span class="keywordtype">int</span> scenePixelHeight
<a name="l00154"></a>00154         {
<a name="l00155"></a>00155                 <span class="keyword">get</span>
<a name="l00156"></a>00156                 {
<a name="l00157"></a>00157                         <span class="keywordflow">if</span>(sceneCamera != null)
<a name="l00158"></a>00158                         {
<a name="l00159"></a>00159                                 <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)sceneCamera.pixelHeight;
<a name="l00160"></a>00160                         }
<a name="l00161"></a>00161                         <span class="keywordflow">else</span>
<a name="l00162"></a>00162                         {
<a name="l00163"></a>00163                                 <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)Screen.height;
<a name="l00164"></a>00164                         }
<a name="l00165"></a>00165                 }
<a name="l00166"></a>00166         }
<a name="l00167"></a>00167 
<a name="l00168"></a>00168         <span class="keyword">private</span> MeshRenderer _meshRenderer;
<a name="l00169"></a>00169 
<a name="l00170"></a>00170         <span class="keyword">public</span> MeshRenderer meshRenderer
<a name="l00171"></a>00171         {
<a name="l00172"></a>00172                 <span class="keyword">get</span>
<a name="l00173"></a>00173                 {
<a name="l00174"></a>00174                         <span class="keywordflow">if</span>(_meshRenderer == null)
<a name="l00175"></a>00175                         {
<a name="l00176"></a>00176                                 _meshRenderer = ragePixelSprite.GetComponent&lt;MeshRenderer&gt;();
<a name="l00177"></a>00177                         }
<a name="l00178"></a>00178                         <span class="keywordflow">return</span> _meshRenderer;
<a name="l00179"></a>00179                 }
<a name="l00180"></a>00180         }
<a name="l00181"></a>00181 
<a name="l00182"></a>00182         <span class="keyword">private</span> MeshFilter _meshFilter;
<a name="l00183"></a>00183 
<a name="l00184"></a>00184         <span class="keyword">public</span> MeshFilter meshFilter
<a name="l00185"></a>00185         {
<a name="l00186"></a>00186                 <span class="keyword">get</span>
<a name="l00187"></a>00187                 {
<a name="l00188"></a>00188                         <span class="keywordflow">if</span>(_meshFilter == null)
<a name="l00189"></a>00189                         {
<a name="l00190"></a>00190                                 _meshFilter = ragePixelSprite.GetComponent&lt;MeshFilter&gt;();
<a name="l00191"></a>00191                         }
<a name="l00192"></a>00192                         <span class="keywordflow">return</span> _meshFilter;
<a name="l00193"></a>00193                 }
<a name="l00194"></a>00194         }
<a name="l00195"></a>00195 
<a name="l00196"></a>00196         <span class="keyword">private</span> Texture2D _spritesheetTexture;
<a name="l00197"></a>00197 
<a name="l00198"></a>00198         <span class="keyword">public</span> Texture2D spritesheetTexture
<a name="l00199"></a>00199         {
<a name="l00200"></a>00200                 <span class="keyword">get</span>
<a name="l00201"></a>00201                 {
<a name="l00202"></a>00202                         <span class="keywordflow">if</span>(_spritesheetTexture == null)
<a name="l00203"></a>00203                         {
<a name="l00204"></a>00204                                 _spritesheetTexture = ragePixelSprite.spriteSheet.atlas.GetTexture(<span class="stringliteral">&quot;_MainTex&quot;</span>) as Texture2D;
<a name="l00205"></a>00205                         }
<a name="l00206"></a>00206                         <span class="keywordflow">return</span> _spritesheetTexture;
<a name="l00207"></a>00207                 }
<a name="l00208"></a>00208         }
<a name="l00209"></a>00209 
<a name="l00210"></a>00210         <span class="keyword">private</span> <a class="code" href="class_rage_pixel_sprite.html">RagePixelSprite</a> _ragePixelSprite;
<a name="l00211"></a>00211 
<a name="l00212"></a>00212         <span class="keyword">public</span> <a class="code" href="class_rage_pixel_sprite.html">RagePixelSprite</a> ragePixelSprite
<a name="l00213"></a>00213         {
<a name="l00214"></a>00214                 <span class="keyword">get</span>
<a name="l00215"></a>00215                 {
<a name="l00216"></a>00216                         <span class="keywordflow">if</span>(_ragePixelSprite == null)
<a name="l00217"></a>00217                         {
<a name="l00218"></a>00218                                 _ragePixelSprite = target as <a class="code" href="class_rage_pixel_sprite.html">RagePixelSprite</a>;
<a name="l00219"></a>00219                         }
<a name="l00220"></a>00220                         <span class="keywordflow">return</span> _ragePixelSprite;
<a name="l00221"></a>00221                 }
<a name="l00222"></a>00222         }
<a name="l00223"></a>00223 
<a name="l00224"></a>00224         <span class="keyword">private</span> <a class="code" href="class_rage_pixel_palette_g_u_i.html">RagePixelPaletteGUI</a> _paletteGUI;
<a name="l00225"></a>00225 
<a name="l00226"></a>00226         <a class="code" href="class_rage_pixel_palette_g_u_i.html">RagePixelPaletteGUI</a> paletteGUI
<a name="l00227"></a>00227         {
<a name="l00228"></a>00228                 <span class="keyword">get</span>
<a name="l00229"></a>00229                 {
<a name="l00230"></a>00230                         <span class="keywordflow">if</span>(_paletteGUI == null)
<a name="l00231"></a>00231                         {
<a name="l00232"></a>00232                                 _paletteGUI = <span class="keyword">new</span> <a class="code" href="class_rage_pixel_palette_g_u_i.html">RagePixelPaletteGUI</a>();
<a name="l00233"></a>00233                                 _paletteGUI.backgroundColor = <span class="keyword">new</span> Color(0f, 0f, 0f, 0f);
<a name="l00234"></a>00234                                 _paletteGUI.positionX = scenePixelWidth - _paletteGUI.pixelWidth;
<a name="l00235"></a>00235                                 _paletteGUI.positionY = 5;
<a name="l00236"></a>00236                                 _paletteGUI.maxWidth = scenePixelWidth - 300;
<a name="l00237"></a>00237                         }
<a name="l00238"></a>00238                         <span class="keywordflow">return</span> _paletteGUI;
<a name="l00239"></a>00239                 }
<a name="l00240"></a>00240         }
<a name="l00241"></a>00241 
<a name="l00242"></a>00242         <span class="keyword">private</span> <a class="code" href="class_rage_pixel_anim_strip_g_u_i.html">RagePixelAnimStripGUI</a> _animStripGUI;
<a name="l00243"></a>00243 
<a name="l00244"></a>00244         <span class="keyword">public</span> <a class="code" href="class_rage_pixel_anim_strip_g_u_i.html">RagePixelAnimStripGUI</a> animStripGUI
<a name="l00245"></a>00245         {
<a name="l00246"></a>00246                 <span class="keyword">get</span>
<a name="l00247"></a>00247                 {
<a name="l00248"></a>00248                         <span class="keywordflow">if</span>(_animStripGUI == null)
<a name="l00249"></a>00249                         {
<a name="l00250"></a>00250                                 _animStripGUI = <span class="keyword">new</span> <a class="code" href="class_rage_pixel_anim_strip_g_u_i.html">RagePixelAnimStripGUI</a>(spriteSheetGUI);
<a name="l00251"></a>00251                                 _animStripGUI.backgroundColor = <span class="keyword">new</span> Color(0.2f, 0.2f, 0.2f, 1f);
<a name="l00252"></a>00252                                 _animStripGUI.currentCellKey = ragePixelSprite.currentCellKey;
<a name="l00253"></a>00253                                 _animStripGUI.positionX = defaultSceneButtonWidth + 10;
<a name="l00254"></a>00254                                 _animStripGUI.positionY = scenePixelHeight - _animStripGUI.thumbnailSize - 7;
<a name="l00255"></a>00255                                 _animStripGUI.maxWidth = scenePixelWidth - defaultSceneButtonWidth * 3 - 20;
<a name="l00256"></a>00256                         }
<a name="l00257"></a>00257                         <span class="keywordflow">return</span> _animStripGUI;
<a name="l00258"></a>00258                 }
<a name="l00259"></a>00259         }
<a name="l00260"></a>00260 
<a name="l00261"></a>00261         <span class="keyword">private</span> <a class="code" href="class_rage_pixel_sprite_sheet_g_u_i.html">RagePixelSpriteSheetGUI</a> _spriteSheetGUI;
<a name="l00262"></a>00262 
<a name="l00263"></a>00263         <span class="keyword">public</span> <a class="code" href="class_rage_pixel_sprite_sheet_g_u_i.html">RagePixelSpriteSheetGUI</a> spriteSheetGUI
<a name="l00264"></a>00264         {
<a name="l00265"></a>00265                 <span class="keyword">get</span>
<a name="l00266"></a>00266                 {
<a name="l00267"></a>00267                         <span class="keywordflow">if</span>(_spriteSheetGUI == null)
<a name="l00268"></a>00268                         {
<a name="l00269"></a>00269                                 _spriteSheetGUI = <span class="keyword">new</span> <a class="code" href="class_rage_pixel_sprite_sheet_g_u_i.html">RagePixelSpriteSheetGUI</a>();
<a name="l00270"></a>00270                                 spriteSheetGUI.currentRowKey = ragePixelSprite.currentRowKey;
<a name="l00271"></a>00271                                 spriteSheetGUI.spriteSheet = ragePixelSprite.spriteSheet;
<a name="l00272"></a>00272                         }
<a name="l00273"></a>00273                         <span class="keywordflow">return</span> _spriteSheetGUI;
<a name="l00274"></a>00274                 }
<a name="l00275"></a>00275         }
<a name="l00276"></a>00276 
<a name="l00277"></a>00277         <span class="keyword">private</span> <a class="code" href="class_rage_pixel_color_picker_g_u_i.html">RagePixelColorPickerGUI</a> _paintColorPickerGUI;
<a name="l00278"></a>00278 
<a name="l00279"></a>00279         <span class="keyword">public</span> <a class="code" href="class_rage_pixel_color_picker_g_u_i.html">RagePixelColorPickerGUI</a> paintColorPickerGUI
<a name="l00280"></a>00280         {
<a name="l00281"></a>00281                 <span class="keyword">get</span>
<a name="l00282"></a>00282                 {
<a name="l00283"></a>00283                         <span class="keywordflow">if</span>(_paintColorPickerGUI == null)
<a name="l00284"></a>00284                         {
<a name="l00285"></a>00285                                 _paintColorPickerGUI = <span class="keyword">new</span> <a class="code" href="class_rage_pixel_color_picker_g_u_i.html">RagePixelColorPickerGUI</a>();
<a name="l00286"></a>00286                                 _paintColorPickerGUI.gizmoVisible = <span class="keyword">false</span>;
<a name="l00287"></a>00287                                 _paintColorPickerGUI.visible = <span class="keyword">false</span>;
<a name="l00288"></a>00288                                 _paintColorPickerGUI.gizmoPositionX = 5;
<a name="l00289"></a>00289                                 _paintColorPickerGUI.gizmoPositionY = 5;
<a name="l00290"></a>00290                                 _paintColorPickerGUI.positionX = _paintColorPickerGUI.gizmoPositionX + _paintColorPickerGUI.gizmoPixelWidth;
<a name="l00291"></a>00291                                 _paintColorPickerGUI.positionY = _paintColorPickerGUI.gizmoPositionY;
<a name="l00292"></a>00292                         }
<a name="l00293"></a>00293                         <span class="keywordflow">return</span> _paintColorPickerGUI;
<a name="l00294"></a>00294                 }
<a name="l00295"></a>00295         }
<a name="l00296"></a>00296 
<a name="l00297"></a>00297         <span class="keyword">private</span> <a class="code" href="class_rage_pixel_color_picker_g_u_i.html">RagePixelColorPickerGUI</a> _replaceColorPickerGUI;
<a name="l00298"></a>00298 
<a name="l00299"></a>00299         <span class="keyword">public</span> <a class="code" href="class_rage_pixel_color_picker_g_u_i.html">RagePixelColorPickerGUI</a> replaceColorPickerGUI
<a name="l00300"></a>00300         {
<a name="l00301"></a>00301                 <span class="keyword">get</span>
<a name="l00302"></a>00302                 {
<a name="l00303"></a>00303                         <span class="keywordflow">if</span>(_replaceColorPickerGUI == null)
<a name="l00304"></a>00304                         {
<a name="l00305"></a>00305                                 _replaceColorPickerGUI = <span class="keyword">new</span> <a class="code" href="class_rage_pixel_color_picker_g_u_i.html">RagePixelColorPickerGUI</a>();
<a name="l00306"></a>00306                                 _replaceColorPickerGUI.gizmoVisible = <span class="keyword">false</span>;
<a name="l00307"></a>00307                                 _replaceColorPickerGUI.visible = <span class="keyword">false</span>;
<a name="l00308"></a>00308                                 _replaceColorPickerGUI.gizmoPositionX = (int)paintColorPickerGUI.gizmoBounds.xMax + (<span class="keywordtype">int</span>)defaultSceneButtonWidth;
<a name="l00309"></a>00309                                 _replaceColorPickerGUI.gizmoPositionY = 5;
<a name="l00310"></a>00310                                 _replaceColorPickerGUI.gizmoPixelWidth = (int)defaultSceneButtonWidth;
<a name="l00311"></a>00311                                 _replaceColorPickerGUI.gizmoPixelHeight = (int)defaultSceneButtonWidth;
<a name="l00312"></a>00312                                 _replaceColorPickerGUI.positionX = _replaceColorPickerGUI.gizmoPositionX + (int)defaultSceneButtonWidth;
<a name="l00313"></a>00313                                 _replaceColorPickerGUI.positionY = _replaceColorPickerGUI.gizmoPositionY;
<a name="l00314"></a>00314                         }
<a name="l00315"></a>00315                         <span class="keywordflow">return</span> _replaceColorPickerGUI;
<a name="l00316"></a>00316                 }
<a name="l00317"></a>00317         }
<a name="l00318"></a>00318 
<a name="l00319"></a>00319         <span class="keyword">private</span> <span class="keywordtype">bool</span> showGrid9Gizmo = <span class="keyword">false</span>;
<a name="l00320"></a>00320 
<a name="l00321"></a>00321         <span class="keyword">public</span> <span class="keywordtype">void</span> OnDestroy()
<a name="l00322"></a>00322         {
<a name="l00323"></a>00323                 spriteSheetGUI.CleanExit();
<a name="l00324"></a>00324                 animStripGUI.CleanExit();
<a name="l00325"></a>00325                 paintColorPickerGUI.CleanExit();
<a name="l00326"></a>00326                 replaceColorPickerGUI.CleanExit();
<a name="l00327"></a>00327         }
<a name="l00328"></a>00328         
<a name="l00329"></a>00329         <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> OnInspectorGUI()
<a name="l00330"></a>00330         {
<a name="l00331"></a>00331                 InvokeOnSelectedEvent();
<a name="l00332"></a>00332                 GUILayout.Space(5f);
<a name="l00333"></a>00333                 
<a name="l00334"></a>00334                 <span class="keywordflow">if</span>(ragePixelSprite.spriteSheet == null)
<a name="l00335"></a>00335                 {
<a name="l00336"></a>00336                         ragePixelSprite.spriteSheet = (<a class="code" href="class_rage_pixel_sprite_sheet.html">RagePixelSpriteSheet</a>)EditorGUILayout.ObjectField(<span class="stringliteral">&quot;Sprite Sheet&quot;</span>, ragePixelSprite.spriteSheet, typeof(<a class="code" href="class_rage_pixel_sprite_sheet.html">RagePixelSpriteSheet</a>), <span class="keyword">false</span>, null);
<a name="l00337"></a>00337                         <span class="keywordflow">if</span>(ragePixelSprite.spriteSheet != null)
<a name="l00338"></a>00338                         {
<a name="l00339"></a>00339                                 <span class="keywordflow">if</span>(ragePixelSprite.currentRowKey == 0 || ragePixelSprite.currentCellKey == 0)
<a name="l00340"></a>00340                                 {
<a name="l00341"></a>00341                                         ragePixelSprite.currentRowKey = ragePixelSprite.spriteSheet.rows[0].key;
<a name="l00342"></a>00342                                         ragePixelSprite.currentCellKey = ragePixelSprite.spriteSheet.rows[0].cells[0].key;
<a name="l00343"></a>00343                                 }
<a name="l00344"></a>00344                                 _spritesheetTexture = null;
<a name="l00345"></a>00345                                 ragePixelSprite.meshIsDirty = <span class="keyword">true</span>;
<a name="l00346"></a>00346                                 ragePixelSprite.refreshMesh();
<a name="l00347"></a>00347                         }
<a name="l00348"></a>00348                 }
<a name="l00349"></a>00349                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!Application.isPlaying)
<a name="l00350"></a>00350                 {
<a name="l00351"></a>00351                         <span class="keywordtype">int</span> spriteSheetGUIMargin = 7;
<a name="l00352"></a>00352 
<a name="l00353"></a>00353                         <a class="code" href="class_rage_pixel_sprite_sheet.html">RagePixelSpriteSheet</a> oldSheet = ragePixelSprite.spriteSheet;
<a name="l00354"></a>00354                         ragePixelSprite.spriteSheet =
<a name="l00355"></a>00355                 (<a class="code" href="class_rage_pixel_sprite_sheet.html">RagePixelSpriteSheet</a>)EditorGUILayout.ObjectField(
<a name="l00356"></a>00356                     <span class="stringliteral">&quot;Sprite sheet&quot;</span>,
<a name="l00357"></a>00357                     ragePixelSprite.spriteSheet,
<a name="l00358"></a>00358                     typeof(<a class="code" href="class_rage_pixel_sprite_sheet.html">RagePixelSpriteSheet</a>),
<a name="l00359"></a>00359                     <span class="keyword">false</span>
<a name="l00360"></a>00360                     );
<a name="l00361"></a>00361 
<a name="l00362"></a>00362                         <span class="keywordflow">if</span>(ragePixelSprite.spriteSheet != null)
<a name="l00363"></a>00363                         {
<a name="l00364"></a>00364 
<a name="l00365"></a>00365                                 <span class="keywordflow">if</span>(oldSheet != ragePixelSprite.spriteSheet)
<a name="l00366"></a>00366                                 {
<a name="l00367"></a>00367                                         <span class="keywordflow">if</span>(ragePixelSprite.currentRowKey == 0 || ragePixelSprite.currentCellKey == 0)
<a name="l00368"></a>00368                                         {
<a name="l00369"></a>00369                                                 ragePixelSprite.currentRowKey = ragePixelSprite.spriteSheet.rows[0].key;
<a name="l00370"></a>00370                                                 ragePixelSprite.currentCellKey = ragePixelSprite.spriteSheet.rows[0].cells[0].key;
<a name="l00371"></a>00371                                         }
<a name="l00372"></a>00372                                         _spritesheetTexture = null;
<a name="l00373"></a>00373                                         ragePixelSprite.meshIsDirty = <span class="keyword">true</span>;
<a name="l00374"></a>00374                                         ragePixelSprite.refreshMesh();
<a name="l00375"></a>00375                                 }
<a name="l00376"></a>00376 
<a name="l00377"></a>00377                                 spriteSheetGUI.maxWidth = Screen.width - spriteSheetGUIMargin;
<a name="l00378"></a>00378                                 spriteSheetGUI.spriteSheet = ragePixelSprite.spriteSheet;
<a name="l00379"></a>00379                                 spriteSheetGUI.currentRowKey = ragePixelSprite.currentRowKey;
<a name="l00380"></a>00380                                 animStripGUI.currentCellKey = ragePixelSprite.currentCellKey;
<a name="l00381"></a>00381 
<a name="l00382"></a>00382                                 <a class="code" href="class_rage_pixel_sprite.html">RagePixelSprite</a>.Mode oldMode = ragePixelSprite.mode;
<a name="l00383"></a>00383                                 ragePixelSprite.mode =
<a name="l00384"></a>00384                     (<a class="code" href="class_rage_pixel_sprite.html">RagePixelSprite</a>.Mode)EditorGUILayout.EnumPopup(
<a name="l00385"></a>00385                         <span class="stringliteral">&quot;Mode&quot;</span>,
<a name="l00386"></a>00386                         ragePixelSprite.mode
<a name="l00387"></a>00387                         );
<a name="l00388"></a>00388 
<a name="l00389"></a>00389                                 <span class="keywordflow">if</span>(oldMode != ragePixelSprite.mode)
<a name="l00390"></a>00390                                 {
<a name="l00391"></a>00391                                         mode = Mode.Default;
<a name="l00392"></a>00392                                         selection = null;
<a name="l00393"></a>00393                                         selectionActive = <span class="keyword">false</span>;
<a name="l00394"></a>00394                                         ragePixelSprite.meshIsDirty = <span class="keyword">true</span>;
<a name="l00395"></a>00395                                         ragePixelSprite.refreshMesh();
<a name="l00396"></a>00396                                         ragePixelSprite.SnapToScale();
<a name="l00397"></a>00397                                 }
<a name="l00398"></a>00398 
<a name="l00399"></a>00399                                 <span class="keywordflow">if</span>(ragePixelSprite.mode == <a class="code" href="class_rage_pixel_sprite.html">RagePixelSprite</a>.Mode.Grid9)
<a name="l00400"></a>00400                                 {
<a name="l00401"></a>00401                                         EditorGUI.indentLevel = 1;
<a name="l00402"></a>00402                                         <span class="keywordtype">bool</span> changed = GUI.changed;
<a name="l00403"></a>00403 
<a name="l00404"></a>00404                                         ragePixelSprite.grid9Left = Mathf.Max(Mathf.Min(EditorGUILayout.IntField(<span class="stringliteral">&quot;Left Margin&quot;</span>, ragePixelSprite.grid9Left), ragePixelSprite.pixelSizeX - ragePixelSprite.grid9Right, ragePixelSprite.GetCurrentRow().pixelSizeX - ragePixelSprite.grid9Right - 1), 0);
<a name="l00405"></a>00405                                         ragePixelSprite.grid9Top = Mathf.Max(Mathf.Min(EditorGUILayout.IntField(<span class="stringliteral">&quot;Top Margin&quot;</span>, ragePixelSprite.grid9Top), ragePixelSprite.pixelSizeY - ragePixelSprite.grid9Bottom, ragePixelSprite.GetCurrentRow().pixelSizeY - ragePixelSprite.grid9Bottom - 1), 0);
<a name="l00406"></a>00406                                         ragePixelSprite.grid9Right = Mathf.Max(Mathf.Min(EditorGUILayout.IntField(<span class="stringliteral">&quot;Right Margin&quot;</span>, ragePixelSprite.grid9Right), ragePixelSprite.pixelSizeX - ragePixelSprite.grid9Left, ragePixelSprite.GetCurrentRow().pixelSizeX - ragePixelSprite.grid9Left - 1), 0);
<a name="l00407"></a>00407                                         ragePixelSprite.grid9Bottom = Mathf.Max(Mathf.Min(EditorGUILayout.IntField(<span class="stringliteral">&quot;Bottom Margin&quot;</span>, ragePixelSprite.grid9Bottom), ragePixelSprite.pixelSizeY - ragePixelSprite.grid9Top, ragePixelSprite.GetCurrentRow().pixelSizeY - ragePixelSprite.grid9Top - 1), 0);
<a name="l00408"></a>00408 
<a name="l00409"></a>00409                                         <span class="keywordflow">if</span>(changed != GUI.changed)
<a name="l00410"></a>00410                                         {
<a name="l00411"></a>00411                                                 ragePixelSprite.meshIsDirty = <span class="keyword">true</span>;
<a name="l00412"></a>00412                                                 ragePixelSprite.refreshMesh();
<a name="l00413"></a>00413                                         }
<a name="l00414"></a>00414 
<a name="l00415"></a>00415                                         showGrid9Gizmo = EditorGUILayout.Toggle(<span class="stringliteral">&quot;Show Gizmos&quot;</span>, showGrid9Gizmo);
<a name="l00416"></a>00416                                         EditorGUI.indentLevel = 0;
<a name="l00417"></a>00417                                 }
<a name="l00418"></a>00418 
<a name="l00419"></a>00419                                 <a class="code" href="class_rage_pixel_sprite.html">RagePixelSprite</a>.PivotMode oldPivotMode = ragePixelSprite.pivotMode;
<a name="l00420"></a>00420                                 ragePixelSprite.pivotMode = (<a class="code" href="class_rage_pixel_sprite.html">RagePixelSprite</a>.PivotMode)EditorGUILayout.EnumPopup(<span class="stringliteral">&quot;Pivot&quot;</span>, ragePixelSprite.pivotMode);
<a name="l00421"></a>00421                                 <span class="keywordflow">if</span>(oldPivotMode != ragePixelSprite.pivotMode)
<a name="l00422"></a>00422                                 {
<a name="l00423"></a>00423                                         ragePixelSprite.meshIsDirty = <span class="keyword">true</span>;
<a name="l00424"></a>00424                                         ragePixelSprite.refreshMesh();
<a name="l00425"></a>00425                                         ragePixelSprite.SnapToScale();
<a name="l00426"></a>00426                                 }
<a name="l00427"></a>00427 
<a name="l00428"></a>00428                                 Color oldColor = ragePixelSprite.tintColor;
<a name="l00429"></a>00429                                 ragePixelSprite.tintColor = EditorGUILayout.ColorField(<span class="stringliteral">&quot;Tint Color&quot;</span>, ragePixelSprite.tintColor);
<a name="l00430"></a>00430                                 <span class="keywordflow">if</span>(ragePixelSprite.tintColor != oldColor)
<a name="l00431"></a>00431                                 {
<a name="l00432"></a>00432                                         ragePixelSprite.vertexColorsAreDirty = <span class="keyword">true</span>;
<a name="l00433"></a>00433                                         ragePixelSprite.refreshMesh();
<a name="l00434"></a>00434                                 }
<a name="l00435"></a>00435 
<a name="l00436"></a>00436                                 ragePixelSprite.animationMode = (<a class="code" href="class_rage_pixel_sprite.html">RagePixelSprite</a>.AnimationMode)EditorGUILayout.EnumPopup(<span class="stringliteral">&quot;Animation Mode&quot;</span>, ragePixelSprite.animationMode);
<a name="l00437"></a>00437                                 ragePixelSprite.playAnimation = EditorGUILayout.Toggle(<span class="stringliteral">&quot;Play On Awake&quot;</span>, ragePixelSprite.playAnimation);
<a name="l00438"></a>00438 
<a name="l00439"></a>00439                                 GUILayout.Space(7f);
<a name="l00440"></a>00440 
<a name="l00441"></a>00441                                 spriteSheetGUI.spriteSheet = ragePixelSprite.spriteSheet;
<a name="l00442"></a>00442                                 spriteSheetGUI.currentRowKey = ragePixelSprite.currentRowKey;
<a name="l00443"></a>00443 
<a name="l00444"></a>00444                                 <span class="keywordflow">if</span>(spriteSheetGUI.HandleGUIEvent(Event.current))
<a name="l00445"></a>00445                                 {
<a name="l00446"></a>00446                                         ragePixelSprite.currentRowKey = spriteSheetGUI.currentRowKey;
<a name="l00447"></a>00447                                         ragePixelSprite.currentCellKey = ragePixelSprite.spriteSheet.GetRow(ragePixelSprite.currentRowKey).cells[0].key;
<a name="l00448"></a>00448                                         ragePixelSprite.pixelSizeX = ragePixelSprite.GetCurrentRow().pixelSizeX;
<a name="l00449"></a>00449                                         ragePixelSprite.pixelSizeY = ragePixelSprite.GetCurrentRow().pixelSizeY;
<a name="l00450"></a>00450                                         ragePixelSprite.meshIsDirty = <span class="keyword">true</span>;
<a name="l00451"></a>00451                                         ragePixelSprite.refreshMesh();
<a name="l00452"></a>00452                                         Repaint();
<a name="l00453"></a>00453                                 }
<a name="l00454"></a>00454 
<a name="l00455"></a>00455                                 spriteSheetGUI.positionX = spriteSheetGUIMargin;
<a name="l00456"></a>00456 
<a name="l00457"></a>00457                                 Rect spriteSheetR = EditorGUILayout.BeginVertical();
<a name="l00458"></a>00458                                 GUILayout.Space(spriteSheetGUI.pixelHeight);
<a name="l00459"></a>00459 
<a name="l00460"></a>00460                                 EditorGUI.DrawPreviewTexture(
<a name="l00461"></a>00461                     <span class="keyword">new</span> Rect(
<a name="l00462"></a>00462                         spriteSheetGUIMargin,
<a name="l00463"></a>00463                         spriteSheetR.yMin,
<a name="l00464"></a>00464                         spriteSheetGUI.pixelWidth,
<a name="l00465"></a>00465                         spriteSheetR.height
<a name="l00466"></a>00466                         ), spriteSheetGUI.spriteSheetTexture);
<a name="l00467"></a>00467 
<a name="l00468"></a>00468                                 EditorGUILayout.EndVertical();
<a name="l00469"></a>00469                                 <span class="keywordflow">if</span>((<span class="keywordtype">int</span>)spriteSheetR.yMin &gt; 0)
<a name="l00470"></a>00470                                 {
<a name="l00471"></a>00471                                         spriteSheetGUI.positionY = (int)spriteSheetR.yMin;
<a name="l00472"></a>00472                                 }
<a name="l00473"></a>00473 
<a name="l00474"></a>00474                                 Rect rButtons = EditorGUILayout.BeginVertical();
<a name="l00475"></a>00475 
<a name="l00476"></a>00476                                 GUILayout.Space(defaultSceneButtonWidth + 5f);
<a name="l00477"></a>00477 
<a name="l00478"></a>00478                                 GUI.color = RagePixelGUIIcons.greenButtonColor;
<a name="l00479"></a>00479                                 <span class="keywordflow">if</span>(GUI.Button(<span class="keyword">new</span> Rect(spriteSheetGUIMargin, rButtons.yMin + 2f, defaultSceneButtonWidth + 6f, defaultSceneButtonHeight), <span class="stringliteral">&quot;NEW&quot;</span>))
<a name="l00480"></a>00480                                 {
<a name="l00481"></a>00481                                         <span class="keywordtype">int</span> index = ragePixelSprite.spriteSheet.GetIndex(spriteSheetGUI.currentRowKey);
<a name="l00482"></a>00482 
<a name="l00483"></a>00483                                         <a class="code" href="class_rage_pixel_row.html">RagePixelRow</a> row =
<a name="l00484"></a>00484                         ragePixelSprite.spriteSheet.AddRow(
<a name="l00485"></a>00485                             RagePixelUtil.RandomKey(),
<a name="l00486"></a>00486                             index + 1,
<a name="l00487"></a>00487                             ragePixelSprite.GetCurrentRow().pixelSizeX,
<a name="l00488"></a>00488                             ragePixelSprite.GetCurrentRow().pixelSizeY
<a name="l00489"></a>00489                             );
<a name="l00490"></a>00490 
<a name="l00491"></a>00491                                         <a class="code" href="class_rage_pixel_cell.html">RagePixelCell</a> cell =
<a name="l00492"></a>00492                         row.InsertCell(0, RagePixelUtil.RandomKey());
<a name="l00493"></a>00493 
<a name="l00494"></a>00494                                         ragePixelSprite.currentRowKey = row.key;
<a name="l00495"></a>00495                                         ragePixelSprite.currentCellKey = cell.key;
<a name="l00496"></a>00496 
<a name="l00497"></a>00497                                         RagePixelUtil.RebuildAtlas(ragePixelSprite.spriteSheet, <span class="keyword">true</span>, <span class="stringliteral">&quot;AddRow&quot;</span>);
<a name="l00498"></a>00498                                         atlasTextureIsDirty = <span class="keyword">true</span>;
<a name="l00499"></a>00499                                 }
<a name="l00500"></a>00500                 
<a name="l00501"></a>00501                                 GUI.color = RagePixelGUIIcons.redButtonColor;
<a name="l00502"></a>00502 
<a name="l00503"></a>00503                                 <span class="keywordflow">if</span>(GUI.Button(<span class="keyword">new</span> Rect(spriteSheetGUIMargin + defaultSceneButtonWidth + 6f, rButtons.yMin + 2f, defaultSceneButtonWidth + 6f, defaultSceneButtonHeight), <span class="stringliteral">&quot;DEL&quot;</span>))
<a name="l00504"></a>00504                                 {
<a name="l00505"></a>00505                                         <span class="keywordflow">if</span>(ragePixelSprite.spriteSheet.rows.Length &gt; 1)
<a name="l00506"></a>00506                                         {
<a name="l00507"></a>00507                                                 <span class="keywordflow">if</span>(EditorUtility.DisplayDialog(<span class="stringliteral">&quot;Delete selected sprite (no undo)?&quot;</span>, <span class="stringliteral">&quot;Are you sure?&quot;</span>, <span class="stringliteral">&quot;Delete&quot;</span>, <span class="stringliteral">&quot;Cancel&quot;</span>))
<a name="l00508"></a>00508                                                 {
<a name="l00509"></a>00509                                                         <span class="keywordtype">int</span> index = ragePixelSprite.spriteSheet.GetIndex(spriteSheetGUI.currentRowKey);
<a name="l00510"></a>00510                                                         ragePixelSprite.spriteSheet.RemoveRowByKey(spriteSheetGUI.currentRowKey);
<a name="l00511"></a>00511                                                         ragePixelSprite.currentRowKey = ragePixelSprite.spriteSheet.rows[Mathf.Clamp(index, 0, ragePixelSprite.spriteSheet.rows.Length - 1)].key;
<a name="l00512"></a>00512                                                         ragePixelSprite.pixelSizeX = ragePixelSprite.GetCurrentRow().pixelSizeX;
<a name="l00513"></a>00513                                                         ragePixelSprite.pixelSizeY = ragePixelSprite.GetCurrentRow().pixelSizeY;
<a name="l00514"></a>00514                                                         RagePixelUtil.RebuildAtlas(ragePixelSprite.spriteSheet, <span class="keyword">false</span>, <span class="stringliteral">&quot;DeleteRow&quot;</span>);
<a name="l00515"></a>00515                                                         ragePixelSprite.currentCellKey = ragePixelSprite.GetCurrentRow().cells[0].key;
<a name="l00516"></a>00516                                                         ragePixelSprite.meshIsDirty = <span class="keyword">true</span>;
<a name="l00517"></a>00517                                                         ragePixelSprite.refreshMesh();
<a name="l00518"></a>00518                                                         atlasTextureIsDirty = <span class="keyword">true</span>;
<a name="l00519"></a>00519                                                 }
<a name="l00520"></a>00520                                         }
<a name="l00521"></a>00521                                         <span class="keywordflow">else</span>
<a name="l00522"></a>00522                                         {
<a name="l00523"></a>00523                                                 EditorUtility.DisplayDialog(<span class="stringliteral">&quot;Cannot delete&quot;</span>, <span class="stringliteral">&quot;Cannot delete the last sprite.&quot;</span>, <span class="stringliteral">&quot;OK&quot;</span>);
<a name="l00524"></a>00524                                         }
<a name="l00525"></a>00525                                 }
<a name="l00526"></a>00526 
<a name="l00527"></a>00527                                 GUI.color = RagePixelGUIIcons.neutralButtonColor;
<a name="l00528"></a>00528                                 <span class="keywordflow">if</span>(GUI.Button(<span class="keyword">new</span> Rect(spriteSheetGUIMargin + defaultSceneButtonWidth * 2f + 12f, rButtons.yMin + 2f, defaultSceneButtonWidth + 10f, defaultSceneButtonHeight), <span class="stringliteral">&quot;EDIT&quot;</span>))
<a name="l00529"></a>00529                                 {
<a name="l00530"></a>00530                                         <span class="keywordflow">if</span>(ragePixelSprite.spriteSheet != null)
<a name="l00531"></a>00531                                         {
<a name="l00532"></a>00532                                                 <a class="code" href="class_rage_pixel_sprite_sheet_editor_window.html">RagePixelSpriteSheetEditorWindow</a> editorWindow = ScriptableObject.CreateInstance(typeof(<a class="code" href="class_rage_pixel_sprite_sheet_editor_window.html">RagePixelSpriteSheetEditorWindow</a>)) as <a class="code" href="class_rage_pixel_sprite_sheet_editor_window.html">RagePixelSpriteSheetEditorWindow</a>;
<a name="l00533"></a>00533                                                 editorWindow.inspector = <span class="keyword">this</span>;
<a name="l00534"></a>00534                                                 <span class="keywordflow">if</span>(ragePixelSprite != null)
<a name="l00535"></a>00535                                                 {
<a name="l00536"></a>00536                                                         editorWindow.selectedSprite = ragePixelSprite;
<a name="l00537"></a>00537                                                 }
<a name="l00538"></a>00538                                                 editorWindow.title = <span class="stringliteral">&quot;Spritesheet&quot;</span>;
<a name="l00539"></a>00539                                                 editorWindow.spriteSheet = ragePixelSprite.spriteSheet;
<a name="l00540"></a>00540                                                 editorWindow.Show();
<a name="l00541"></a>00541                                         }
<a name="l00542"></a>00542                                 }
<a name="l00543"></a>00543                                 EditorGUILayout.EndVertical();
<a name="l00544"></a>00544                                 GUI.color = Color.white;
<a name="l00545"></a>00545 
<a name="l00546"></a>00546                                 GUILayout.Space(7f);
<a name="l00547"></a>00547                         }
<a name="l00548"></a>00548                 }
<a name="l00549"></a>00549                 <span class="keywordflow">else</span>
<a name="l00550"></a>00550                 {
<a name="l00551"></a>00551                         GUILayout.Space(5f);
<a name="l00552"></a>00552                         EditorUtility.SetSelectedWireframeHidden(meshRenderer, <span class="keyword">true</span>);
<a name="l00553"></a>00553                         GUILayout.Label(<span class="stringliteral">&quot;Inspector GUI disabled in play mode&quot;</span>);
<a name="l00554"></a>00554                         GUILayout.Space(5f);
<a name="l00555"></a>00555                 }
<a name="l00556"></a>00556                 
<a name="l00557"></a>00557         }
<a name="l00558"></a>00558         
<a name="l00559"></a>00559         <span class="keyword">public</span> <span class="keywordtype">void</span> OnSceneGUI()
<a name="l00560"></a>00560         {
<a name="l00561"></a>00561             InvokeOnSelectedEvent();
<a name="l00562"></a>00562 
<a name="l00563"></a>00563                 <span class="keywordflow">if</span>(!Application.isPlaying)
<a name="l00564"></a>00564                 {
<a name="l00565"></a>00565                         <span class="keywordflow">if</span>(ragePixelSprite.spriteSheet != null)
<a name="l00566"></a>00566                         {
<a name="l00567"></a>00567                                 SceneGUIInit();
<a name="l00568"></a>00568                 
<a name="l00569"></a>00569                                 <span class="keywordtype">bool</span> colorReplaced = <span class="keyword">false</span>;
<a name="l00570"></a>00570 
<a name="l00571"></a>00571                                 <span class="comment">// GUI</span>
<a name="l00572"></a>00572                                 Handles.BeginGUI();
<a name="l00573"></a>00573                                 HandleCameraWarnings();
<a name="l00574"></a>00574                                 HandleColorPickerGUI();
<a name="l00575"></a>00575                                 HandlePaintGUI();
<a name="l00576"></a>00576                                 HandlePaletteGUI();
<a name="l00577"></a>00577                                 HandleAnimationGUI();
<a name="l00578"></a>00578                                 DrawGizmos();
<a name="l00579"></a>00579                                 Handles.EndGUI();
<a name="l00580"></a>00580 
<a name="l00581"></a>00581                                 HandleKeyboard();
<a name="l00582"></a>00582 
<a name="l00583"></a>00583                                 <span class="keywordflow">switch</span>(mode)
<a name="l00584"></a>00584                                 {
<a name="l00585"></a>00585                                 <span class="keywordflow">case</span> (Mode.Default):
<a name="l00586"></a>00586                                         HandleModeDefault();
<a name="l00587"></a>00587                                         <span class="keywordflow">break</span>;
<a name="l00588"></a>00588                                 <span class="keywordflow">case</span> (Mode.Pen):
<a name="l00589"></a>00589                                         HandleModePen();
<a name="l00590"></a>00590                                         <span class="keywordflow">break</span>;
<a name="l00591"></a>00591                                 <span class="keywordflow">case</span> (Mode.Fill):
<a name="l00592"></a>00592                                         HandleModeFill();
<a name="l00593"></a>00593                                         <span class="keywordflow">break</span>;
<a name="l00594"></a>00594                                 <span class="keywordflow">case</span> (Mode.Select):
<a name="l00595"></a>00595                                         HandleModeSelect();
<a name="l00596"></a>00596                                         <span class="keywordflow">break</span>;
<a name="l00597"></a>00597                                 <span class="keywordflow">case</span> (Mode.Resize):
<a name="l00598"></a>00598                                         HandleModeResize();
<a name="l00599"></a>00599                                         <span class="keywordflow">break</span>;
<a name="l00600"></a>00600                                 }
<a name="l00601"></a>00601 
<a name="l00602"></a>00602                                 <span class="keywordflow">if</span>(Event.current.type == EventType.mouseUp)
<a name="l00603"></a>00603                                 {
<a name="l00604"></a>00604                                         paintUndoSaved = <span class="keyword">false</span>;
<a name="l00605"></a>00605                                 }
<a name="l00606"></a>00606 
<a name="l00607"></a>00607                                 <span class="keywordflow">if</span>(atlasTextureIsDirty &amp;&amp; Event.current.type == EventType.mouseUp || colorReplaced)
<a name="l00608"></a>00608                                 {
<a name="l00609"></a>00609                                         saveTexture();
<a name="l00610"></a>00610                                         animStripGUI.isDirty = <span class="keyword">true</span>;
<a name="l00611"></a>00611                                         spriteSheetGUI.isDirty = <span class="keyword">true</span>;
<a name="l00612"></a>00612                                         atlasTextureIsDirty = <span class="keyword">false</span>;
<a name="l00613"></a>00613                                 }
<a name="l00614"></a>00614                         }
<a name="l00615"></a>00615                 }
<a name="l00616"></a>00616                 <span class="keywordflow">else</span>
<a name="l00617"></a>00617                 {
<a name="l00618"></a>00618                         DrawSpriteBoundsGizmo();
<a name="l00619"></a>00619                 }
<a name="l00620"></a>00620         }
<a name="l00621"></a>00621     
<a name="l00622"></a>00622         <span class="keyword">public</span> <span class="keywordtype">void</span> HandleModeDefault()
<a name="l00623"></a>00623         {
<a name="l00624"></a>00624                 Vector2 newScale = 
<a name="l00625"></a>00625             ragePixelSprite.transform.InverseTransformPoint(
<a name="l00626"></a>00626                 Handles.FreeMoveHandle(
<a name="l00627"></a>00627                     ragePixelSprite.transform.TransformPoint(<span class="keyword">new</span> Vector3(ragePixelSprite.pixelSizeX, ragePixelSprite.pixelSizeY, 0f) + GetPivotOffset()), 
<a name="l00628"></a>00628                     Quaternion.identity, 
<a name="l00629"></a>00629                     sceneCamera.orthographicSize * handleSize, 
<a name="l00630"></a>00630                     <span class="keyword">new</span> Vector3(1f, 1f, 0f), 
<a name="l00631"></a>00631                     Handles.RectangleCap
<a name="l00632"></a>00632                 )
<a name="l00633"></a>00633             ) - GetPivotOffset();
<a name="l00634"></a>00634 
<a name="l00635"></a>00635                 <span class="keywordflow">if</span>(ragePixelSprite.pixelSizeX != Mathf.RoundToInt(newScale.x) || ragePixelSprite.pixelSizeY != Mathf.RoundToInt(newScale.y))
<a name="l00636"></a>00636                 {
<a name="l00637"></a>00637                         <span class="keywordtype">int</span> minX = ragePixelSprite.mode != <a class="code" href="class_rage_pixel_sprite.html">RagePixelSprite</a>.Mode.Grid9 ? 1 : ragePixelSprite.grid9Left + ragePixelSprite.grid9Right + 1;
<a name="l00638"></a>00638                         <span class="keywordtype">int</span> minY = ragePixelSprite.mode != <a class="code" href="class_rage_pixel_sprite.html">RagePixelSprite</a>.Mode.Grid9 ? 1 : ragePixelSprite.grid9Top + ragePixelSprite.grid9Bottom + 1;
<a name="l00639"></a>00639             
<a name="l00640"></a>00640                         ragePixelSprite.pixelSizeX = Mathf.Max(Mathf.RoundToInt(newScale.x), minX);
<a name="l00641"></a>00641                         ragePixelSprite.pixelSizeY = Mathf.Max(Mathf.RoundToInt(newScale.y), minY);
<a name="l00642"></a>00642                         ragePixelSprite.meshIsDirty = <span class="keyword">true</span>;
<a name="l00643"></a>00643                         ragePixelSprite.refreshMesh();
<a name="l00644"></a>00644                 } 
<a name="l00645"></a>00645         }
<a name="l00646"></a>00646 
<a name="l00647"></a>00647         <span class="keyword">public</span> <span class="keywordtype">void</span> HandleModePen()
<a name="l00648"></a>00648         {
<a name="l00649"></a>00649                 <span class="keywordflow">if</span>(Event.current.type == EventType.mouseDown || Event.current.type == EventType.mouseDrag)
<a name="l00650"></a>00650                 {
<a name="l00651"></a>00651                         Vector3 mouseWorldPosition = sceneScreenToWorldPoint(Event.current.mousePosition);
<a name="l00652"></a>00652 
<a name="l00653"></a>00653                         <a class="code" href="class_rage_pixel_texel.html">RagePixelTexel</a> texel = WorldToTexelCoords(spritesheetTexture, ragePixelSprite.transform, mouseWorldPosition);
<a name="l00654"></a>00654 
<a name="l00655"></a>00655                         <span class="keywordflow">if</span>(texel.X &gt;= 0 &amp;&amp; texel.X &lt; ragePixelSprite.GetCurrentRow().pixelSizeX &amp;&amp;
<a name="l00656"></a>00656                 texel.Y &gt;= 0 &amp;&amp; texel.Y &lt; ragePixelSprite.GetCurrentRow().pixelSizeY)
<a name="l00657"></a>00657                         {
<a name="l00658"></a>00658                                 Rect uv = ragePixelSprite.GetCurrentCell().uv;
<a name="l00659"></a>00659                                 <span class="keywordtype">int</span> minX = Mathf.FloorToInt(spritesheetTexture.width * uv.xMin);
<a name="l00660"></a>00660                                 <span class="keywordtype">int</span> minY = Mathf.FloorToInt(spritesheetTexture.height * uv.yMin);
<a name="l00661"></a>00661 
<a name="l00662"></a>00662                                 <span class="keywordflow">if</span>(Event.current.button == 0)
<a name="l00663"></a>00663                                 {
<a name="l00664"></a>00664                                         SavePaintUndo();
<a name="l00665"></a>00665 
<a name="l00666"></a>00666                                         atlasTextureIsDirty = <span class="keyword">true</span>;
<a name="l00667"></a>00667                       
<a name="l00668"></a>00668                                         <span class="comment">/*</span>
<a name="l00669"></a>00669 <span class="comment">                    spritesheetTexture.SetPixel(</span>
<a name="l00670"></a>00670 <span class="comment">                        minX + texel.X,</span>
<a name="l00671"></a>00671 <span class="comment">                        minY + texel.Y,</span>
<a name="l00672"></a>00672 <span class="comment">                        paintColorPickerGUI.selectedColor);</span>
<a name="l00673"></a>00673 <span class="comment">                    */</span>
<a name="l00674"></a>00674 
<a name="l00675"></a>00675                                         brush.PasteToTextureWithBounds(
<a name="l00676"></a>00676                         minX + texel.X - Mathf.FloorToInt(brush.Width() / 2f),
<a name="l00677"></a>00677                         minY + texel.Y - Mathf.FloorToInt(brush.Height() / 2f), 
<a name="l00678"></a>00678                         minX, 
<a name="l00679"></a>00679                         minY, 
<a name="l00680"></a>00680                         minX + ragePixelSprite.GetCurrentRow().pixelSizeX,
<a name="l00681"></a>00681                         minY + ragePixelSprite.GetCurrentRow().pixelSizeY, 
<a name="l00682"></a>00682                         spritesheetTexture,
<a name="l00683"></a>00683                         paintColorPickerGUI.selectedColor
<a name="l00684"></a>00684                         );
<a name="l00685"></a>00685 
<a name="l00686"></a>00686                                         spritesheetTexture.Apply();
<a name="l00687"></a>00687                     
<a name="l00688"></a>00688                                         paintColorPickerGUI.selectedColor = spritesheetTexture.GetPixel(
<a name="l00689"></a>00689                         minX + texel.X,
<a name="l00690"></a>00690                         minY + texel.Y);
<a name="l00691"></a>00691                     
<a name="l00692"></a>00692                                 }
<a name="l00693"></a>00693                                 <span class="keywordflow">else</span>
<a name="l00694"></a>00694                                 {
<a name="l00695"></a>00695                                         paintColorPickerGUI.selectedColor = spritesheetTexture.GetPixel(
<a name="l00696"></a>00696                         minX + texel.X,
<a name="l00697"></a>00697                         minY + texel.Y);
<a name="l00698"></a>00698 
<a name="l00699"></a>00699                                         replaceColorPickerGUI.selectedColor = paintColorPickerGUI.selectedColor;
<a name="l00700"></a>00700                                         paletteGUI.SelectColor(paintColorPickerGUI.selectedColor);
<a name="l00701"></a>00701 
<a name="l00702"></a>00702                                         <span class="keywordflow">if</span>(Event.current.control || Event.current.command)
<a name="l00703"></a>00703                                         {
<a name="l00704"></a>00704                                                 paletteGUI.AddColor(paintColorPickerGUI.selectedColor);
<a name="l00705"></a>00705                                         }
<a name="l00706"></a>00706                                 }
<a name="l00707"></a>00707                         }
<a name="l00708"></a>00708                         <span class="keywordflow">else</span>
<a name="l00709"></a>00709                         {
<a name="l00710"></a>00710                                 <span class="keywordflow">if</span>(Event.current.button == 1)
<a name="l00711"></a>00711                                 {
<a name="l00712"></a>00712                                         paintColorPickerGUI.selectedColor = <span class="keyword">new</span> Color(0f, 0f, 0f, 0f);
<a name="l00713"></a>00713                                         replaceColorPickerGUI.selectedColor = paintColorPickerGUI.selectedColor;
<a name="l00714"></a>00714                                 }
<a name="l00715"></a>00715                         }
<a name="l00716"></a>00716 
<a name="l00717"></a>00717                         Event.current.Use();
<a name="l00718"></a>00718                 }
<a name="l00719"></a>00719         }
<a name="l00720"></a>00720 
<a name="l00721"></a>00721         <span class="keyword">public</span> <span class="keywordtype">void</span> HandleModeFill()
<a name="l00722"></a>00722         {
<a name="l00723"></a>00723                 <span class="keywordflow">if</span>(Event.current.type == EventType.mouseDown)
<a name="l00724"></a>00724                 {
<a name="l00725"></a>00725                         Vector3 mouseWorldPosition = sceneScreenToWorldPoint(Event.current.mousePosition);
<a name="l00726"></a>00726 
<a name="l00727"></a>00727                         <a class="code" href="class_rage_pixel_texel.html">RagePixelTexel</a> texel = WorldToTexelCoords(spritesheetTexture, ragePixelSprite.transform, mouseWorldPosition);
<a name="l00728"></a>00728 
<a name="l00729"></a>00729                         Rect uv = ragePixelSprite.GetCurrentCell().uv;
<a name="l00730"></a>00730                         <span class="keywordtype">int</span> minX = Mathf.FloorToInt(spritesheetTexture.width * uv.xMin);
<a name="l00731"></a>00731                         <span class="keywordtype">int</span> minY = Mathf.FloorToInt(spritesheetTexture.height * uv.yMin);
<a name="l00732"></a>00732                         <span class="keywordtype">int</span> maxX = Mathf.FloorToInt(spritesheetTexture.width * uv.xMax);
<a name="l00733"></a>00733                         <span class="keywordtype">int</span> maxY = Mathf.FloorToInt(spritesheetTexture.height * uv.yMax);
<a name="l00734"></a>00734 
<a name="l00735"></a>00735                         <span class="keywordflow">if</span>(texel.X &gt;= 0 &amp;&amp; texel.X &lt; ragePixelSprite.GetCurrentRow().pixelSizeX &amp;&amp;
<a name="l00736"></a>00736                 texel.Y &gt;= 0 &amp;&amp; texel.Y &lt; ragePixelSprite.GetCurrentRow().pixelSizeY)
<a name="l00737"></a>00737                         {
<a name="l00738"></a>00738                                 <span class="keywordflow">if</span>(Event.current.button == 0)
<a name="l00739"></a>00739                                 {
<a name="l00740"></a>00740                                         Color fillTargetColor = spritesheetTexture.GetPixel(minX + texel.X, minY + texel.Y);
<a name="l00741"></a>00741 
<a name="l00742"></a>00742                                         <span class="keywordflow">if</span>(!fillTargetColor.Equals(paintColorPickerGUI.selectedColor))
<a name="l00743"></a>00743                                         {
<a name="l00744"></a>00744                                                 SavePaintUndo();
<a name="l00745"></a>00745                                                 atlasTextureIsDirty = <span class="keyword">true</span>;
<a name="l00746"></a>00746                                                 FloodFill(
<a name="l00747"></a>00747                             fillTargetColor,
<a name="l00748"></a>00748                             paintColorPickerGUI.selectedColor,
<a name="l00749"></a>00749                             spritesheetTexture,
<a name="l00750"></a>00750                             minX + texel.X,
<a name="l00751"></a>00751                             minY + texel.Y,
<a name="l00752"></a>00752                             minX,
<a name="l00753"></a>00753                             minY,
<a name="l00754"></a>00754                             maxX,
<a name="l00755"></a>00755                             maxY);
<a name="l00756"></a>00756                                                 spritesheetTexture.Apply();
<a name="l00757"></a>00757                                                 paintColorPickerGUI.selectedColor = spritesheetTexture.GetPixel(
<a name="l00758"></a>00758                         minX + texel.X,
<a name="l00759"></a>00759                         minY + texel.Y);
<a name="l00760"></a>00760                                         }
<a name="l00761"></a>00761                                 }
<a name="l00762"></a>00762                                 <span class="keywordflow">else</span>
<a name="l00763"></a>00763                                 {
<a name="l00764"></a>00764                                         paintColorPickerGUI.selectedColor = spritesheetTexture.GetPixel(
<a name="l00765"></a>00765                         minX + texel.X,
<a name="l00766"></a>00766                         minY + texel.Y);
<a name="l00767"></a>00767                                         replaceColorPickerGUI.selectedColor = paintColorPickerGUI.selectedColor;
<a name="l00768"></a>00768                                 }
<a name="l00769"></a>00769                         }
<a name="l00770"></a>00770                         <span class="keywordflow">else</span>
<a name="l00771"></a>00771                         {
<a name="l00772"></a>00772                                 <span class="keywordflow">if</span>(Event.current.button == 1)
<a name="l00773"></a>00773                                 {
<a name="l00774"></a>00774                                         paintColorPickerGUI.selectedColor = <span class="keyword">new</span> Color(0f, 0f, 0f, 0f);
<a name="l00775"></a>00775                                         replaceColorPickerGUI.selectedColor = paintColorPickerGUI.selectedColor;
<a name="l00776"></a>00776                                 }
<a name="l00777"></a>00777                         }
<a name="l00778"></a>00778                         Event.current.Use();
<a name="l00779"></a>00779                 }
<a name="l00780"></a>00780         }
<a name="l00781"></a>00781 
<a name="l00782"></a>00782         <span class="keyword">public</span> <span class="keywordtype">void</span> HandleModeSelect()
<a name="l00783"></a>00783         {
<a name="l00784"></a>00784                 <span class="keywordflow">if</span>(Event.current.type == EventType.mouseDown || Event.current.type == EventType.mouseDrag || Event.current.type == EventType.mouseUp)
<a name="l00785"></a>00785                 {
<a name="l00786"></a>00786                         Vector3 mouseWorldPosition = sceneScreenToWorldPoint(Event.current.mousePosition);
<a name="l00787"></a>00787 
<a name="l00788"></a>00788                         <a class="code" href="class_rage_pixel_texel.html">RagePixelTexel</a> texel = WorldToTexelCoords(spritesheetTexture, ragePixelSprite.transform, mouseWorldPosition);
<a name="l00789"></a>00789                         <span class="keywordtype">int</span> spriteWidth = ragePixelSprite.GetCurrentRow().pixelSizeX;
<a name="l00790"></a>00790                         <span class="keywordtype">int</span> spriteHeight = ragePixelSprite.GetCurrentRow().pixelSizeY;
<a name="l00791"></a>00791 
<a name="l00792"></a>00792                         <span class="keywordflow">if</span>(texel.X &gt;= 0 &amp;&amp; texel.X &lt; spriteWidth &amp;&amp;
<a name="l00793"></a>00793                 texel.Y &gt;= 0 &amp;&amp; texel.Y &lt; spriteHeight)
<a name="l00794"></a>00794                         {
<a name="l00795"></a>00795                                 <span class="keywordflow">if</span>(Event.current.type == EventType.mouseDown)
<a name="l00796"></a>00796                                 {
<a name="l00797"></a>00797                                         <span class="keywordflow">if</span>(Event.current.button == 0)
<a name="l00798"></a>00798                                         {
<a name="l00799"></a>00799                                                 <span class="keywordflow">if</span>(selection == null)
<a name="l00800"></a>00800                                                 {
<a name="l00801"></a>00801                                                         selectionActive = <span class="keyword">false</span>;
<a name="l00802"></a>00802                                                         selectionStart = texel;
<a name="l00803"></a>00803                                                         selection = <span class="keyword">new</span> <a class="code" href="class_rage_pixel_texel_rect.html">RagePixelTexelRect</a>(texel.X, texel.Y, texel.X, texel.Y);
<a name="l00804"></a>00804                                                 }
<a name="l00805"></a>00805                                                 <span class="keywordflow">else</span>
<a name="l00806"></a>00806                                                 {
<a name="l00807"></a>00807                                                         <span class="keywordflow">if</span>(texel.X &lt; frontBufferPosition.X || texel.Y &lt; frontBufferPosition.Y || texel.X &gt; frontBufferPosition.X + selection.Width() || texel.Y &gt; frontBufferPosition.Y + selection.Height())
<a name="l00808"></a>00808                                                         {
<a name="l00809"></a>00809                                                                 selectionActive = <span class="keyword">false</span>;
<a name="l00810"></a>00810                                                                 selectionStart = texel;
<a name="l00811"></a>00811                                                                 selection = <span class="keyword">new</span> <a class="code" href="class_rage_pixel_texel_rect.html">RagePixelTexelRect</a>(texel.X, texel.Y, texel.X, texel.Y);
<a name="l00812"></a>00812                                                         }
<a name="l00813"></a>00813                                                         <span class="keywordflow">else</span>
<a name="l00814"></a>00814                                                         {
<a name="l00815"></a>00815                                                                 frontBufferDragStartMousePosition = texel;
<a name="l00816"></a>00816                                                                 frontBufferDragStartPosition = frontBufferPosition;
<a name="l00817"></a>00817                                                         }
<a name="l00818"></a>00818                                                 }
<a name="l00819"></a>00819                                         }
<a name="l00820"></a>00820                                 }
<a name="l00821"></a>00821                                 <span class="keywordflow">if</span>(Event.current.type == EventType.mouseDrag)
<a name="l00822"></a>00822                                 {
<a name="l00823"></a>00823                                         <span class="keywordflow">if</span>(selectionActive)
<a name="l00824"></a>00824                                         {
<a name="l00825"></a>00825                                                 <a class="code" href="class_rage_pixel_texel.html">RagePixelTexel</a> movement = <span class="keyword">new</span> <a class="code" href="class_rage_pixel_texel.html">RagePixelTexel</a>(texel.X - frontBufferDragStartMousePosition.X, texel.Y - frontBufferDragStartMousePosition.Y);
<a name="l00826"></a>00826                                                 frontBufferPosition = <span class="keyword">new</span> <a class="code" href="class_rage_pixel_texel.html">RagePixelTexel</a>(frontBufferDragStartPosition.X + movement.X, frontBufferDragStartPosition.Y + movement.Y);
<a name="l00827"></a>00827 
<a name="l00828"></a>00828                                                 Rect spriteUV = ragePixelSprite.GetCurrentCell().uv;
<a name="l00829"></a>00829 
<a name="l00830"></a>00830                                                 PasteBitmapToSpritesheet(<span class="keyword">new</span> <a class="code" href="class_rage_pixel_texel.html">RagePixelTexel</a>(0, 0), spriteUV, backBuffer);
<a name="l00831"></a>00831                                                 PasteBitmapToSpritesheetAlpha(frontBufferPosition, spriteUV, frontBuffer);
<a name="l00832"></a>00832 
<a name="l00833"></a>00833                                                 spritesheetTexture.Apply();
<a name="l00834"></a>00834                                         }
<a name="l00835"></a>00835                                         <span class="keywordflow">else</span>
<a name="l00836"></a>00836                                         {
<a name="l00837"></a>00837                                                 selection = <span class="keyword">new</span> <a class="code" href="class_rage_pixel_texel_rect.html">RagePixelTexelRect</a>(selectionStart.X, selectionStart.Y, texel.X, texel.Y);
<a name="l00838"></a>00838                                         }
<a name="l00839"></a>00839                                 }
<a name="l00840"></a>00840                                 <span class="keywordflow">if</span>(Event.current.type == EventType.mouseUp &amp;&amp; !selectionActive)
<a name="l00841"></a>00841                                 {
<a name="l00842"></a>00842                                         <span class="keywordflow">if</span>(selection.Width() &gt; 1 || selection.Height() &gt; 1)
<a name="l00843"></a>00843                                         {
<a name="l00844"></a>00844                                                 SavePaintUndo();
<a name="l00845"></a>00845 
<a name="l00846"></a>00846                                                 Rect spriteUV = ragePixelSprite.GetCurrentCell().uv;
<a name="l00847"></a>00847 
<a name="l00848"></a>00848                                                 frontBuffer = GrabRectFromSpritesheet(selection);
<a name="l00849"></a>00849                                                 CutRectInSpritesheet(selection, spriteUV);
<a name="l00850"></a>00850                                                 backBuffer = GrabSprite(spriteUV);
<a name="l00851"></a>00851 
<a name="l00852"></a>00852                                                 frontBufferPosition = <span class="keyword">new</span> <a class="code" href="class_rage_pixel_texel.html">RagePixelTexel</a>(selection.X, selection.Y);
<a name="l00853"></a>00853                                                 frontBufferDragStartPosition = <span class="keyword">new</span> <a class="code" href="class_rage_pixel_texel.html">RagePixelTexel</a>(selection.X, selection.Y);
<a name="l00854"></a>00854 
<a name="l00855"></a>00855                                                 PasteBitmapToSpritesheetAlpha(frontBufferPosition, spriteUV, frontBuffer);
<a name="l00856"></a>00856 
<a name="l00857"></a>00857                                                 selectionActive = <span class="keyword">true</span>;
<a name="l00858"></a>00858                                                 spritesheetTexture.Apply();
<a name="l00859"></a>00859                                         }
<a name="l00860"></a>00860                                         <span class="keywordflow">else</span>
<a name="l00861"></a>00861                                         {
<a name="l00862"></a>00862                                                 selection = null;
<a name="l00863"></a>00863                                                 selectionActive = <span class="keyword">false</span>;
<a name="l00864"></a>00864                                         }
<a name="l00865"></a>00865                                 }
<a name="l00866"></a>00866                                 <span class="keywordflow">if</span>(selectionActive &amp;&amp; Event.current.type == EventType.mouseUp)
<a name="l00867"></a>00867                                 {
<a name="l00868"></a>00868                                         spritesheetTexture.Apply();
<a name="l00869"></a>00869                                         atlasTextureIsDirty = <span class="keyword">true</span>;
<a name="l00870"></a>00870                                 }
<a name="l00871"></a>00871                         }
<a name="l00872"></a>00872                         <span class="keywordflow">else</span>
<a name="l00873"></a>00873                         {
<a name="l00874"></a>00874                                 <span class="keywordflow">if</span>(Event.current.type != EventType.mouseDrag)
<a name="l00875"></a>00875                                 {
<a name="l00876"></a>00876                                         mode = Mode.Default;
<a name="l00877"></a>00877                                 }
<a name="l00878"></a>00878 
<a name="l00879"></a>00879                         }
<a name="l00880"></a>00880                         <span class="keywordflow">if</span>(Event.current.type != EventType.mouseUp)
<a name="l00881"></a>00881                         {
<a name="l00882"></a>00882                                 Event.current.Use();
<a name="l00883"></a>00883                         }
<a name="l00884"></a>00884                 }
<a name="l00885"></a>00885         }
<a name="l00886"></a>00886 
<a name="l00887"></a>00887         <span class="keyword">public</span> <span class="keywordtype">void</span> HandleModeResize()
<a name="l00888"></a>00888         {
<a name="l00889"></a>00889                 <span class="keywordtype">bool</span> isMouseUp = <span class="keyword">false</span>;
<a name="l00890"></a>00890                 <span class="keywordflow">if</span>(Event.current.type == EventType.MouseUp)
<a name="l00891"></a>00891                 {
<a name="l00892"></a>00892                         isMouseUp = <span class="keyword">true</span>;
<a name="l00893"></a>00893                 }
<a name="l00894"></a>00894                     
<a name="l00895"></a>00895                 Vector2 newSize = Handles.FreeMoveHandle(ragePixelSprite.transform.position + <span class="keyword">new</span> Vector3(ragePixelSprite.GetCurrentRow().newPixelSizeX, ragePixelSprite.GetCurrentRow().newPixelSizeY, 0f) + GetPivotOffset(), Quaternion.identity, sceneCamera.orthographicSize * handleSize, <span class="keyword">new</span> Vector3(1f, 1f, 0f), Handles.CircleCap) - ragePixelSprite.transform.position - GetPivotOffset();
<a name="l00896"></a>00896                 newSize.x = Mathf.Max(newSize.x, 1f);
<a name="l00897"></a>00897                 newSize.y = Mathf.Max(newSize.y, 1f);
<a name="l00898"></a>00898                     
<a name="l00899"></a>00899                 ragePixelSprite.GetCurrentRow().newPixelSizeX = Mathf.Clamp(Mathf.RoundToInt(newSize.x), 1, 2048);
<a name="l00900"></a>00900                 ragePixelSprite.GetCurrentRow().newPixelSizeY = Mathf.Clamp(Mathf.RoundToInt(newSize.y), 1, 2048);
<a name="l00901"></a>00901 
<a name="l00902"></a>00902                 <span class="keywordflow">if</span>(ragePixelSprite.GetCurrentRow().pixelSizeX != Mathf.RoundToInt(newSize.x) || ragePixelSprite.GetCurrentRow().pixelSizeY != Mathf.RoundToInt(newSize.y))
<a name="l00903"></a>00903                 {
<a name="l00904"></a>00904                         <span class="keywordflow">if</span>(isMouseUp)
<a name="l00905"></a>00905                         {
<a name="l00906"></a>00906                                 <span class="keywordtype">bool</span> userOK = <span class="keyword">false</span>;
<a name="l00907"></a>00907                                 <span class="keywordflow">if</span>(newSize.x &lt; ragePixelSprite.GetCurrentRow().pixelSizeX || newSize.y &lt; ragePixelSprite.GetCurrentRow().pixelSizeY)
<a name="l00908"></a>00908                                 {
<a name="l00909"></a>00909                                         userOK = EditorUtility.DisplayDialog(<span class="stringliteral">&quot;Resize&quot;</span>, <span class="stringliteral">&quot;Sprite bitmap will be cropped to smaller size (no undo).\nAre you sure?&quot;</span>, <span class="stringliteral">&quot;OK&quot;</span>, <span class="stringliteral">&quot;Cancel&quot;</span>);
<a name="l00910"></a>00910                                 }
<a name="l00911"></a>00911                                 <span class="keywordflow">else</span>
<a name="l00912"></a>00912                                 {
<a name="l00913"></a>00913                                         userOK = <span class="keyword">true</span>;
<a name="l00914"></a>00914                                 }
<a name="l00915"></a>00915 
<a name="l00916"></a>00916                                 <span class="keywordflow">if</span>(userOK)
<a name="l00917"></a>00917                                 {
<a name="l00918"></a>00918                                         ragePixelSprite.GetCurrentRow().ClearUndoHistory();
<a name="l00919"></a>00919 
<a name="l00920"></a>00920                                         ragePixelSprite.pixelSizeX = ragePixelSprite.GetCurrentRow().newPixelSizeX;
<a name="l00921"></a>00921                                         ragePixelSprite.pixelSizeY = ragePixelSprite.GetCurrentRow().newPixelSizeY;
<a name="l00922"></a>00922 
<a name="l00923"></a>00923                                         <span class="keywordtype">bool</span> isGrowing =
<a name="l00924"></a>00924                         ragePixelSprite.GetCurrentRow().newPixelSizeX &gt; ragePixelSprite.GetCurrentRow().pixelSizeX ||
<a name="l00925"></a>00925                         ragePixelSprite.GetCurrentRow().newPixelSizeY &gt; ragePixelSprite.GetCurrentRow().pixelSizeY;
<a name="l00926"></a>00926 
<a name="l00927"></a>00927                                         spriteSheetGUI.isDirty = <span class="keyword">true</span>;
<a name="l00928"></a>00928                                         animStripGUI.isDirty = <span class="keyword">true</span>;
<a name="l00929"></a>00929                                         ragePixelSprite.meshIsDirty = <span class="keyword">true</span>;
<a name="l00930"></a>00930 
<a name="l00931"></a>00931                                         RagePixelUtil.RebuildAtlas(ragePixelSprite.spriteSheet, isGrowing, <span class="stringliteral">&quot;resize&quot;</span>);
<a name="l00932"></a>00932                                 }
<a name="l00933"></a>00933                         }
<a name="l00934"></a>00934                 }
<a name="l00935"></a>00935         }
<a name="l00936"></a>00936 
<a name="l00937"></a>00937         <span class="keyword">public</span> <span class="keywordtype">void</span> SceneGUIInit()
<a name="l00938"></a>00938         {
<a name="l00939"></a>00939                 GUI.backgroundColor = <span class="keyword">new</span> Color(1f, 1f, 1f, 1f);
<a name="l00940"></a>00940                 GUI.color = <span class="keyword">new</span> Color(1f, 1f, 1f, 1f);
<a name="l00941"></a>00941 
<a name="l00942"></a>00942                 <span class="keywordflow">if</span>(!showGrid9Gizmo)
<a name="l00943"></a>00943                 {
<a name="l00944"></a>00944                         EditorUtility.SetSelectedWireframeHidden(meshRenderer, <span class="keyword">true</span>);
<a name="l00945"></a>00945                 }
<a name="l00946"></a>00946                 <span class="keywordflow">else</span>
<a name="l00947"></a>00947                 {
<a name="l00948"></a>00948                         EditorUtility.SetSelectedWireframeHidden(meshRenderer, <span class="keyword">false</span>);
<a name="l00949"></a>00949                 }
<a name="l00950"></a>00950 
<a name="l00951"></a>00951                 <span class="keywordflow">if</span>(mode != Mode.Default &amp;&amp; mode != Mode.Resize || animStripGUI.visible)
<a name="l00952"></a>00952                 {
<a name="l00953"></a>00953                         HandleUtility.AddDefaultControl(GUIUtility.GetControlID(FocusType.Passive));
<a name="l00954"></a>00954                 }
<a name="l00955"></a>00955         
<a name="l00956"></a>00956                 <span class="keywordflow">if</span>(Event.current.type == EventType.mouseUp)
<a name="l00957"></a>00957                 {
<a name="l00958"></a>00958                         ragePixelSprite.SnapToIntegerPosition();
<a name="l00959"></a>00959                 }
<a name="l00960"></a>00960 
<a name="l00961"></a>00961                 Tools.pivotMode = PivotMode.Pivot;
<a name="l00962"></a>00962         }
<a name="l00963"></a>00963 
<a name="l00964"></a>00964         <span class="keyword">public</span> <span class="keywordtype">void</span> HandleColorPickerGUI()
<a name="l00965"></a>00965         {
<a name="l00966"></a>00966                 <span class="keywordflow">if</span>(paintColorPickerGUI.gizmoVisible)
<a name="l00967"></a>00967                 {
<a name="l00968"></a>00968                         <span class="keywordflow">if</span>(GUI.Button(paintColorPickerGUI.gizmoBounds, paintColorPickerGUI.colorGizmoTexture) &amp;&amp; !replaceColorPickerGUI.visible)
<a name="l00969"></a>00969                         {
<a name="l00970"></a>00970                                 paintColorPickerGUI.visible = !paintColorPickerGUI.visible;
<a name="l00971"></a>00971                         }
<a name="l00972"></a>00972 
<a name="l00973"></a>00973                         <span class="keywordtype">float</span> left = paintColorPickerGUI.visible ? paintColorPickerGUI.bounds.xMax : paintColorPickerGUI.gizmoBounds.xMax;
<a name="l00974"></a>00974 
<a name="l00975"></a>00975                         <span class="keywordflow">if</span>(GUI.Button(<span class="keyword">new</span> Rect(left, replaceColorPickerGUI.bounds.yMin, defaultSceneButtonWidth, defaultSceneButtonWidth), RagePixelGUIIcons.Replace))
<a name="l00976"></a>00976                         {
<a name="l00977"></a>00977                                 replaceColorPickerGUI.visible = <span class="keyword">true</span>;
<a name="l00978"></a>00978                                 paintColorPickerGUI.visible = <span class="keyword">false</span>;
<a name="l00979"></a>00979                                 replaceColorPickerGUI.selectedColor = paintColorPickerGUI.selectedColor;
<a name="l00980"></a>00980                                 colorReplaceBuffer = spritesheetTexture.GetPixels32();
<a name="l00981"></a>00981                         }
<a name="l00982"></a>00982                         
<a name="l00983"></a>00983                         <span class="keywordflow">if</span>(paintColorPickerGUI.visible)
<a name="l00984"></a>00984                         {
<a name="l00985"></a>00985                                 <span class="keywordflow">if</span>(paintColorPickerGUI.HandleGUIEvent(Event.current))
<a name="l00986"></a>00986                                 {
<a name="l00987"></a>00987                                         <span class="keywordflow">if</span>(Event.current.type == EventType.mouseDown || Event.current.type == EventType.mouseUp)
<a name="l00988"></a>00988                                         {
<a name="l00989"></a>00989                                                 paletteGUI.currentIndex = -1;
<a name="l00990"></a>00990                                         }
<a name="l00991"></a>00991                                 }
<a name="l00992"></a>00992 
<a name="l00993"></a>00993                                 GUI.DrawTexture(paintColorPickerGUI.bounds, paintColorPickerGUI.colorPickerTexture);
<a name="l00994"></a>00994                         }
<a name="l00995"></a>00995                 }
<a name="l00996"></a>00996 
<a name="l00997"></a>00997                 <span class="keywordflow">if</span>(replaceColorPickerGUI.visible)
<a name="l00998"></a>00998                 {
<a name="l00999"></a>00999                         <span class="keywordflow">if</span>(GUI.Button(replaceColorPickerGUI.gizmoBounds, replaceColorPickerGUI.colorGizmoTexture))
<a name="l01000"></a>01000                         {
<a name="l01001"></a>01001                                 <span class="comment">//noop</span>
<a name="l01002"></a>01002                         }
<a name="l01003"></a>01003                         <span class="keywordflow">if</span>(GUI.Button(<span class="keyword">new</span> Rect(replaceColorPickerGUI.bounds.xMax + 5, replaceColorPickerGUI.bounds.yMin, 102, 16), <span class="stringliteral">&quot;Apply to sprite&quot;</span>))
<a name="l01004"></a>01004                         {
<a name="l01005"></a>01005                                 <span class="keywordflow">foreach</span>(<a class="code" href="class_rage_pixel_cell.html">RagePixelCell</a> cell <span class="keywordflow">in</span> ragePixelSprite.GetCurrentRow().cells)
<a name="l01006"></a>01006                                 {
<a name="l01007"></a>01007                                         ragePixelSprite.spriteSheet.saveUndo(colorReplaceBuffer, cell);
<a name="l01008"></a>01008                                 }
<a name="l01009"></a>01009 
<a name="l01010"></a>01010                                 paintColorPickerGUI.selectedColor = ragePixelSprite.spriteSheet.replaceColor(colorReplaceBuffer, paintColorPickerGUI.selectedColor, replaceColorPickerGUI.selectedColor, ragePixelSprite.GetCurrentRow());
<a name="l01011"></a>01011                                 replaceColorPickerGUI.selectedColor = paintColorPickerGUI.selectedColor;
<a name="l01012"></a>01012                                 spriteSheetGUI.isDirty = <span class="keyword">true</span>;
<a name="l01013"></a>01013                                 animStripGUI.isDirty = <span class="keyword">true</span>;
<a name="l01014"></a>01014                                 saveTexture();
<a name="l01015"></a>01015                                 ragePixelSprite.refreshMesh();
<a name="l01016"></a>01016                                 EditorUtility.SetDirty(ragePixelSprite);
<a name="l01017"></a>01017                                 replaceColorPickerGUI.visible = <span class="keyword">false</span>;
<a name="l01018"></a>01018                         }
<a name="l01019"></a>01019                         <span class="keywordflow">if</span>(GUI.Button(<span class="keyword">new</span> Rect(replaceColorPickerGUI.bounds.xMax + 5, replaceColorPickerGUI.bounds.yMin + 20, 102, 16), <span class="stringliteral">&quot;Apply to atlas&quot;</span>))
<a name="l01020"></a>01020                         {
<a name="l01021"></a>01021                                 <span class="keywordflow">foreach</span>(<a class="code" href="class_rage_pixel_row.html">RagePixelRow</a> row <span class="keywordflow">in</span> ragePixelSprite.spriteSheet.rows)
<a name="l01022"></a>01022                                 {
<a name="l01023"></a>01023                                         <span class="keywordflow">foreach</span>(<a class="code" href="class_rage_pixel_cell.html">RagePixelCell</a> cell <span class="keywordflow">in</span> row.cells)
<a name="l01024"></a>01024                                         {
<a name="l01025"></a>01025                                                 ragePixelSprite.spriteSheet.saveUndo(colorReplaceBuffer, cell);
<a name="l01026"></a>01026                                         }
<a name="l01027"></a>01027                                 }
<a name="l01028"></a>01028                                 ragePixelSprite.spriteSheet.replaceColor(colorReplaceBuffer, paintColorPickerGUI.selectedColor, replaceColorPickerGUI.selectedColor);
<a name="l01029"></a>01029                                 paintColorPickerGUI.selectedColor = replaceColorPickerGUI.selectedColor;
<a name="l01030"></a>01030                                 spriteSheetGUI.isDirty = <span class="keyword">true</span>;
<a name="l01031"></a>01031                                 animStripGUI.isDirty = <span class="keyword">true</span>;
<a name="l01032"></a>01032                                 saveTexture();
<a name="l01033"></a>01033                                 ragePixelSprite.refreshMesh();
<a name="l01034"></a>01034                                 EditorUtility.SetDirty(ragePixelSprite);
<a name="l01035"></a>01035                                 replaceColorPickerGUI.visible = <span class="keyword">false</span>;
<a name="l01036"></a>01036                         }
<a name="l01037"></a>01037                         <span class="keywordflow">if</span>(GUI.Button(<span class="keyword">new</span> Rect(replaceColorPickerGUI.bounds.xMax + 5, replaceColorPickerGUI.bounds.yMin + 40, 102, 16), <span class="stringliteral">&quot;Cancel&quot;</span>))
<a name="l01038"></a>01038                         {
<a name="l01039"></a>01039                                 spriteSheetGUI.isDirty = <span class="keyword">true</span>;
<a name="l01040"></a>01040                                 animStripGUI.isDirty = <span class="keyword">true</span>;
<a name="l01041"></a>01041                                 spritesheetTexture.SetPixels32(colorReplaceBuffer);
<a name="l01042"></a>01042                                 spritesheetTexture.Apply();
<a name="l01043"></a>01043                                 saveTexture();
<a name="l01044"></a>01044                                 EditorUtility.SetDirty(ragePixelSprite);
<a name="l01045"></a>01045                                 replaceColorPickerGUI.visible = <span class="keyword">false</span>;
<a name="l01046"></a>01046                         }
<a name="l01047"></a>01047                         <span class="keywordflow">if</span>(replaceColorPickerGUI.visible)
<a name="l01048"></a>01048                         {
<a name="l01049"></a>01049                                 <span class="keywordflow">if</span>(replaceColorPickerGUI.HandleGUIEvent(Event.current))
<a name="l01050"></a>01050                                 {
<a name="l01051"></a>01051                                         ragePixelSprite.spriteSheet.replaceColor(colorReplaceBuffer, paintColorPickerGUI.selectedColor, replaceColorPickerGUI.selectedColor, ragePixelSprite.GetCurrentRow());
<a name="l01052"></a>01052                                         <span class="keywordflow">if</span>(Event.current.type == EventType.mouseDown || Event.current.type == EventType.mouseUp)
<a name="l01053"></a>01053                                         {
<a name="l01054"></a>01054                                                 paletteGUI.currentIndex = -1;
<a name="l01055"></a>01055                                         }
<a name="l01056"></a>01056                                 }
<a name="l01057"></a>01057                                 GUI.DrawTexture(replaceColorPickerGUI.bounds, replaceColorPickerGUI.colorPickerTexture);
<a name="l01058"></a>01058                         }
<a name="l01059"></a>01059                 }
<a name="l01060"></a>01060         }
<a name="l01061"></a>01061 
<a name="l01062"></a>01062         <span class="keyword">public</span> <span class="keywordtype">void</span> HandlePaintGUI()
<a name="l01063"></a>01063         {
<a name="l01064"></a>01064                 <span class="keywordtype">int</span> guiPosX = 5;
<a name="l01065"></a>01065                 <span class="keywordtype">int</span> guiPosY = (int)(scenePixelHeight / 2f - defaultSceneButtonWidth * 5f * 0.5f);
<a name="l01066"></a>01066 
<a name="l01067"></a>01067                 GUI.color = GetSceneButtonColor(mode == Mode.Default);
<a name="l01068"></a>01068                 <span class="keywordflow">if</span>(GUI.Button(<span class="keyword">new</span> Rect(guiPosX, guiPosY, defaultSceneButtonWidth, defaultSceneButtonWidth), RagePixelGUIIcons.Cursor))
<a name="l01069"></a>01069                 {
<a name="l01070"></a>01070                         selection = null;
<a name="l01071"></a>01071                         selectionActive = <span class="keyword">false</span>;
<a name="l01072"></a>01072                         paintColorPickerGUI.gizmoVisible = <span class="keyword">false</span>;
<a name="l01073"></a>01073                         mode = Mode.Default;
<a name="l01074"></a>01074                         Tools.current = Tool.Move;
<a name="l01075"></a>01075                 }
<a name="l01076"></a>01076 
<a name="l01077"></a>01077                 GUI.color = GetSceneButtonColor(mode == Mode.Pen);
<a name="l01078"></a>01078                 <span class="keywordflow">if</span>(GUI.Button(<span class="keyword">new</span> Rect(guiPosX, guiPosY += defaultSceneButtonHeight, defaultSceneButtonWidth, defaultSceneButtonWidth), RagePixelGUIIcons.Pen))
<a name="l01079"></a>01079                 {
<a name="l01080"></a>01080                         selection = null;
<a name="l01081"></a>01081                         selectionActive = <span class="keyword">false</span>;
<a name="l01082"></a>01082                         paintColorPickerGUI.gizmoVisible = <span class="keyword">true</span>;
<a name="l01083"></a>01083                         mode = Mode.Pen;
<a name="l01084"></a>01084                         Tools.current = Tool.None;
<a name="l01085"></a>01085                 }
<a name="l01086"></a>01086                 <span class="keywordflow">if</span>(mode == Mode.Pen)
<a name="l01087"></a>01087                 {
<a name="l01088"></a>01088 
<a name="l01089"></a>01089                         GUI.color = GetSceneButtonColor(brushType == BrushType.Brush1);
<a name="l01090"></a>01090                         <span class="keywordflow">if</span>(GUI.Button(<span class="keyword">new</span> Rect(guiPosX + defaultSceneButtonWidth + 2, guiPosY, 9, 8), <span class="stringliteral">&quot;&quot;</span>))
<a name="l01091"></a>01091                         {
<a name="l01092"></a>01092                                 brushType = BrushType.Brush1;
<a name="l01093"></a>01093                         }
<a name="l01094"></a>01094             
<a name="l01095"></a>01095                         GUI.color = GetSceneButtonColor(brushType == BrushType.Brush3);
<a name="l01096"></a>01096                         <span class="keywordflow">if</span>(GUI.Button(<span class="keyword">new</span> Rect(guiPosX + defaultSceneButtonWidth + 2, guiPosY + 10, 12, 10), <span class="stringliteral">&quot;&quot;</span>))
<a name="l01097"></a>01097                         {
<a name="l01098"></a>01098                                 brushType = BrushType.Brush3;
<a name="l01099"></a>01099                         }
<a name="l01100"></a>01100                         GUI.color = GetSceneButtonColor(brushType == BrushType.Brush5);
<a name="l01101"></a>01101                         <span class="keywordflow">if</span>(GUI.Button(<span class="keyword">new</span> Rect(guiPosX + defaultSceneButtonWidth + 2, guiPosY + 20, 15, 12), <span class="stringliteral">&quot;&quot;</span>))
<a name="l01102"></a>01102                         {
<a name="l01103"></a>01103                                 brushType = BrushType.Brush5;
<a name="l01104"></a>01104                         }
<a name="l01105"></a>01105                 }
<a name="l01106"></a>01106 
<a name="l01107"></a>01107                 GUI.color = GetSceneButtonColor(mode == Mode.Fill);
<a name="l01108"></a>01108                 <span class="keywordflow">if</span>(GUI.Button(<span class="keyword">new</span> Rect(guiPosX, guiPosY += defaultSceneButtonWidth, defaultSceneButtonWidth, defaultSceneButtonWidth), RagePixelGUIIcons.Fill))
<a name="l01109"></a>01109                 {
<a name="l01110"></a>01110                         selection = null;
<a name="l01111"></a>01111                         selectionActive = <span class="keyword">false</span>;
<a name="l01112"></a>01112                         paintColorPickerGUI.gizmoVisible = <span class="keyword">true</span>;
<a name="l01113"></a>01113                         mode = Mode.Fill;
<a name="l01114"></a>01114                         Tools.current = Tool.None;
<a name="l01115"></a>01115                 }
<a name="l01116"></a>01116 
<a name="l01117"></a>01117                 GUI.color = GetSceneButtonColor(mode == Mode.Select);
<a name="l01118"></a>01118                 <span class="keywordflow">if</span>(ragePixelSprite.mode == <a class="code" href="class_rage_pixel_sprite.html">RagePixelSprite</a>.Mode.Grid9)
<a name="l01119"></a>01119                 {
<a name="l01120"></a>01120                         GUI.color = <span class="keyword">new</span> Color(1f, 1f, 1f, 0.1f);
<a name="l01121"></a>01121                 }
<a name="l01122"></a>01122                 <span class="keywordflow">if</span>(GUI.Button(<span class="keyword">new</span> Rect(guiPosX, guiPosY += defaultSceneButtonWidth, defaultSceneButtonWidth, defaultSceneButtonWidth), RagePixelGUIIcons.Select) &amp;&amp; ragePixelSprite.mode != <a class="code" href="class_rage_pixel_sprite.html">RagePixelSprite</a>.Mode.Grid9)
<a name="l01123"></a>01123                 {
<a name="l01124"></a>01124                         selection = null;
<a name="l01125"></a>01125                         selectionActive = <span class="keyword">false</span>;
<a name="l01126"></a>01126                         mode = Mode.Select;
<a name="l01127"></a>01127                         Tools.current = Tool.None;
<a name="l01128"></a>01128                 }
<a name="l01129"></a>01129 
<a name="l01130"></a>01130                 GUI.color = GetSceneButtonColor(mode == Mode.Resize);
<a name="l01131"></a>01131                 <span class="keywordflow">if</span>(ragePixelSprite.mode == <a class="code" href="class_rage_pixel_sprite.html">RagePixelSprite</a>.Mode.Grid9)
<a name="l01132"></a>01132                 {
<a name="l01133"></a>01133                         GUI.color = <span class="keyword">new</span> Color(1f, 1f, 1f, 0.1f);
<a name="l01134"></a>01134                 }
<a name="l01135"></a>01135                 <span class="keywordflow">if</span>(GUI.Button(<span class="keyword">new</span> Rect(guiPosX, guiPosY += defaultSceneButtonWidth, defaultSceneButtonWidth, defaultSceneButtonWidth), RagePixelGUIIcons.Resize) &amp;&amp; ragePixelSprite.mode != <a class="code" href="class_rage_pixel_sprite.html">RagePixelSprite</a>.Mode.Grid9)
<a name="l01136"></a>01136                 {
<a name="l01137"></a>01137                         ragePixelSprite.SnapToScale();
<a name="l01138"></a>01138                         selection = null;
<a name="l01139"></a>01139                         selectionActive = <span class="keyword">false</span>;
<a name="l01140"></a>01140                         mode = Mode.Resize;
<a name="l01141"></a>01141                         Tools.current = Tool.None;
<a name="l01142"></a>01142                 }
<a name="l01143"></a>01143         }
<a name="l01144"></a>01144 
<a name="l01145"></a>01145         <span class="keyword">public</span> <span class="keywordtype">void</span> HandlePaletteGUI()
<a name="l01146"></a>01146         {
<a name="l01147"></a>01147                 <span class="keywordflow">if</span>(mode != Mode.Default &amp;&amp; !replaceColorPickerGUI.visible)
<a name="l01148"></a>01148                 {
<a name="l01149"></a>01149                         <span class="keywordtype">int</span> guiPosX = defaultSceneButtonWidth + 5;
<a name="l01150"></a>01150                         <span class="keywordflow">if</span>(paintColorPickerGUI.visible)
<a name="l01151"></a>01151                         {
<a name="l01152"></a>01152                                 guiPosX += paintColorPickerGUI.pixelWidth;
<a name="l01153"></a>01153                         }
<a name="l01154"></a>01154                         <span class="keywordflow">if</span>(replaceColorPickerGUI.visible)
<a name="l01155"></a>01155                         {
<a name="l01156"></a>01156                                 guiPosX += replaceColorPickerGUI.pixelWidth + 145 + 5;
<a name="l01157"></a>01157                         }
<a name="l01158"></a>01158 
<a name="l01159"></a>01159                         GUI.color = Color.white;
<a name="l01160"></a>01160                         paletteGUI.positionX = guiPosX + defaultSceneButtonWidth + 2;
<a name="l01161"></a>01161                         paletteGUI.maxWidth = scenePixelWidth - guiPosX - 130;
<a name="l01162"></a>01162                         paletteGUI.positionY = 5;
<a name="l01163"></a>01163 
<a name="l01164"></a>01164                         GUI.DrawTexture(paletteGUI.bounds, paletteGUI.paletteTexture);
<a name="l01165"></a>01165 
<a name="l01166"></a>01166                         <span class="keywordflow">if</span>(paletteGUI.HandleGUIEvent(Event.current))
<a name="l01167"></a>01167                         {
<a name="l01168"></a>01168                                 <span class="keywordflow">if</span>(paletteGUI.currentIndex &gt;= 0)
<a name="l01169"></a>01169                                 {
<a name="l01170"></a>01170                                         paintColorPickerGUI.selectedColor = RagePixelUtil.Settings.palette[paletteGUI.currentIndex];
<a name="l01171"></a>01171                                         Repaint();
<a name="l01172"></a>01172                                 }
<a name="l01173"></a>01173                         }
<a name="l01174"></a>01174                 }
<a name="l01175"></a>01175         }
<a name="l01176"></a>01176 
<a name="l01177"></a>01177         <span class="keyword">public</span> <span class="keywordtype">void</span> HandleAnimationGUI()
<a name="l01178"></a>01178         {
<a name="l01179"></a>01179                 <span class="keywordtype">int</span> guiPosX = 5;
<a name="l01180"></a>01180         
<a name="l01181"></a>01181                 <span class="keywordflow">if</span>(animationStripEnabled)
<a name="l01182"></a>01182                 {
<a name="l01183"></a>01183                         GUI.color = GetSceneButtonColor(animStripGUI.visible);
<a name="l01184"></a>01184                         <span class="keywordflow">if</span>(GUI.Button(<span class="keyword">new</span> Rect(guiPosX, scenePixelHeight - 40, defaultSceneButtonWidth, defaultSceneButtonWidth), RagePixelGUIIcons.Animation))
<a name="l01185"></a>01185                         {
<a name="l01186"></a>01186                                 animStripGUI.visible = !animStripGUI.visible;
<a name="l01187"></a>01187                                 animStripGUI.isDirty = <span class="keyword">true</span>;
<a name="l01188"></a>01188                         }
<a name="l01189"></a>01189 
<a name="l01190"></a>01190                         <span class="keywordflow">if</span>(animStripGUI.visible)
<a name="l01191"></a>01191                         {
<a name="l01192"></a>01192                                 GUI.color = Color.white;
<a name="l01193"></a>01193                                 animStripGUI.maxWidth = scenePixelWidth - defaultSceneButtonWidth * 3 - 20 - 20;
<a name="l01194"></a>01194                                 animStripGUI.positionY = scenePixelHeight - 8 - animStripGUI.pixelHeight;
<a name="l01195"></a>01195 
<a name="l01196"></a>01196                                 GUI.DrawTexture(animStripGUI.bounds, animStripGUI.animStripTexture);
<a name="l01197"></a>01197 
<a name="l01198"></a>01198                                 GUI.color = RagePixelGUIIcons.greenButtonColor;
<a name="l01199"></a>01199                                 <span class="keywordflow">if</span>(GUI.Button(<span class="keyword">new</span> Rect(scenePixelWidth - (defaultSceneButtonWidth + 6f) * 2 - 5, scenePixelHeight - 40, defaultSceneButtonWidth + 6f, defaultSceneButtonHeight), <span class="stringliteral">&quot;NEW&quot;</span>))
<a name="l01200"></a>01200                                 {
<a name="l01201"></a>01201                                         <span class="keywordtype">int</span> index = ragePixelSprite.GetCurrentRow().GetIndex(ragePixelSprite.currentCellKey) + 1;
<a name="l01202"></a>01202                                         <a class="code" href="class_rage_pixel_cell.html">RagePixelCell</a> cell = ragePixelSprite.GetCurrentRow().InsertCell(index, RagePixelUtil.RandomKey());
<a name="l01203"></a>01203                                         ragePixelSprite.currentCellKey = cell.key;
<a name="l01204"></a>01204                                         RagePixelUtil.RebuildAtlas(ragePixelSprite.spriteSheet, <span class="keyword">true</span>, <span class="stringliteral">&quot;AddCell&quot;</span>);
<a name="l01205"></a>01205                                         atlasTextureIsDirty = <span class="keyword">true</span>;
<a name="l01206"></a>01206                                         spriteSheetGUI.isDirty = <span class="keyword">true</span>;
<a name="l01207"></a>01207                                         animStripGUI.isDirty = <span class="keyword">true</span>;
<a name="l01208"></a>01208                                 }
<a name="l01209"></a>01209                                 GUI.color = RagePixelGUIIcons.redButtonColor;
<a name="l01210"></a>01210                                 <span class="keywordflow">if</span>(GUI.Button(<span class="keyword">new</span> Rect(scenePixelWidth - (defaultSceneButtonWidth + 6f) * 1 - 5, scenePixelHeight - 40, defaultSceneButtonWidth + 6f, defaultSceneButtonHeight), <span class="stringliteral">&quot;DEL&quot;</span>))
<a name="l01211"></a>01211                                 {
<a name="l01212"></a>01212                                         <span class="keywordflow">if</span>(ragePixelSprite.GetCurrentRow().cells.Length &gt; 1)
<a name="l01213"></a>01213                                         {
<a name="l01214"></a>01214                                                 <span class="keywordflow">if</span>(EditorUtility.DisplayDialog(<span class="stringliteral">&quot;Delete selected frame (no undo)?&quot;</span>, <span class="stringliteral">&quot;Are you sure?&quot;</span>, <span class="stringliteral">&quot;Delete&quot;</span>, <span class="stringliteral">&quot;Cancel&quot;</span>))
<a name="l01215"></a>01215                                                 {
<a name="l01216"></a>01216                                                         <span class="keywordtype">int</span> index = ragePixelSprite.GetCurrentRow().GetIndex(ragePixelSprite.currentCellKey);
<a name="l01217"></a>01217                                                         ragePixelSprite.GetCurrentRow().RemoveCellByKey(ragePixelSprite.currentCellKey);
<a name="l01218"></a>01218                                                         RagePixelUtil.RebuildAtlas(ragePixelSprite.spriteSheet, <span class="keyword">false</span>, <span class="stringliteral">&quot;DeleteCell&quot;</span>);
<a name="l01219"></a>01219                                                         ragePixelSprite.currentCellKey = ragePixelSprite.GetCurrentRow().cells[Mathf.Clamp(index, 0, ragePixelSprite.GetCurrentRow().cells.Length - 1)].key;
<a name="l01220"></a>01220                                                         atlasTextureIsDirty = <span class="keyword">true</span>;
<a name="l01221"></a>01221                                                         spriteSheetGUI.isDirty = <span class="keyword">true</span>;
<a name="l01222"></a>01222                                                         animStripGUI.isDirty = <span class="keyword">true</span>;
<a name="l01223"></a>01223                                                 }
<a name="l01224"></a>01224                                         }
<a name="l01225"></a>01225                                         <span class="keywordflow">else</span>
<a name="l01226"></a>01226                                         {
<a name="l01227"></a>01227                                                 EditorUtility.DisplayDialog(<span class="stringliteral">&quot;Cannot delete&quot;</span>, <span class="stringliteral">&quot;Cannot delete the last frame.&quot;</span>, <span class="stringliteral">&quot;OK&quot;</span>);
<a name="l01228"></a>01228                                         }
<a name="l01229"></a>01229                                 }
<a name="l01230"></a>01230 
<a name="l01231"></a>01231                                 <span class="keywordflow">if</span>(animStripGUI.HandleGUIEvent(Event.current))
<a name="l01232"></a>01232                                 {
<a name="l01233"></a>01233                                         ragePixelSprite.currentCellKey = animStripGUI.currentCellKey;
<a name="l01234"></a>01234                                         ragePixelSprite.refreshMesh();
<a name="l01235"></a>01235                                 }
<a name="l01236"></a>01236                                 <span class="keywordflow">else</span>
<a name="l01237"></a>01237                                 {
<a name="l01238"></a>01238                                         <span class="keywordflow">if</span>(Event.current.type == EventType.mouseDown &amp;&amp; mode == Mode.Default)
<a name="l01239"></a>01239                                         {
<a name="l01240"></a>01240                                                 animStripGUI.visible = <span class="keyword">false</span>;
<a name="l01241"></a>01241                                         }
<a name="l01242"></a>01242                                 }
<a name="l01243"></a>01243                         }
<a name="l01244"></a>01244                 }
<a name="l01245"></a>01245         }
<a name="l01246"></a>01246 
<a name="l01247"></a>01247         <span class="keyword">public</span> <span class="keywordtype">void</span> HandleKeyboard()
<a name="l01248"></a>01248         {
<a name="l01249"></a>01249                 <span class="keywordflow">if</span>(Event.current.keyCode == KeyCode.Alpha1)
<a name="l01250"></a>01250                 {
<a name="l01251"></a>01251                         brushType = BrushType.Brush1;
<a name="l01252"></a>01252                 }
<a name="l01253"></a>01253                 <span class="keywordflow">if</span>(Event.current.keyCode == KeyCode.Alpha2)
<a name="l01254"></a>01254                 {
<a name="l01255"></a>01255                         brushType = BrushType.Brush3;
<a name="l01256"></a>01256                 }
<a name="l01257"></a>01257                 <span class="keywordflow">if</span>(Event.current.keyCode == KeyCode.Alpha3)
<a name="l01258"></a>01258                 {
<a name="l01259"></a>01259                         brushType = BrushType.Brush5;
<a name="l01260"></a>01260                 }
<a name="l01261"></a>01261                 <span class="keywordflow">if</span>(Event.current.keyCode == KeyCode.RightBracket)
<a name="l01262"></a>01262                 {
<a name="l01263"></a>01263                         brushType = (BrushType)((<span class="keywordtype">int</span>)brushType &lt; 2 ? (int)brushType + 1 : 0);
<a name="l01264"></a>01264                 }
<a name="l01265"></a>01265                 <span class="keywordflow">if</span>(Event.current.keyCode == KeyCode.LeftBracket)
<a name="l01266"></a>01266                 {
<a name="l01267"></a>01267                         brushType = (BrushType)((<span class="keywordtype">int</span>)brushType &gt; 0 ? (int)brushType - 1 : 2);
<a name="l01268"></a>01268                 }
<a name="l01269"></a>01269                 <span class="keywordflow">if</span>(Event.current.keyCode == KeyCode.RightArrow &amp;&amp; (Event.current.control || Event.current.command) &amp;&amp; Event.current.type == EventType.keyDown)
<a name="l01270"></a>01270                 {
<a name="l01271"></a>01271                         selection = null;
<a name="l01272"></a>01272                         selectionActive = <span class="keyword">false</span>;
<a name="l01273"></a>01273                         ragePixelSprite.shiftCell(1, <span class="keyword">true</span>);
<a name="l01274"></a>01274                         ragePixelSprite.refreshMesh();
<a name="l01275"></a>01275                         animStripGUI.isDirty = <span class="keyword">true</span>;
<a name="l01276"></a>01276                         Event.current.Use();
<a name="l01277"></a>01277                 }
<a name="l01278"></a>01278                 <span class="keywordflow">if</span>(Event.current.keyCode == KeyCode.LeftArrow &amp;&amp; (Event.current.control || Event.current.command) &amp;&amp; Event.current.type == EventType.keyDown)
<a name="l01279"></a>01279                 {
<a name="l01280"></a>01280                         selection = null;
<a name="l01281"></a>01281                         selectionActive = <span class="keyword">false</span>;
<a name="l01282"></a>01282                         ragePixelSprite.shiftCell(-1, <span class="keyword">true</span>);
<a name="l01283"></a>01283                         ragePixelSprite.refreshMesh();
<a name="l01284"></a>01284                         animStripGUI.isDirty = <span class="keyword">true</span>;
<a name="l01285"></a>01285                         Event.current.Use();
<a name="l01286"></a>01286                 }
<a name="l01287"></a>01287                 <span class="keywordflow">if</span>(Event.current.keyCode == KeyCode.Z &amp;&amp; (Event.current.control || Event.current.command) &amp;&amp; Event.current.alt &amp;&amp; Event.current.type == EventType.keyDown)
<a name="l01288"></a>01288                 {
<a name="l01289"></a>01289                         DoPaintUndo();
<a name="l01290"></a>01290                         animStripGUI.isDirty = <span class="keyword">true</span>;
<a name="l01291"></a>01291                         spriteSheetGUI.isDirty = <span class="keyword">true</span>;
<a name="l01292"></a>01292                         atlasTextureIsDirty = <span class="keyword">true</span>;
<a name="l01293"></a>01293                         Event.current.Use();
<a name="l01294"></a>01294                 }
<a name="l01295"></a>01295                 <span class="keywordflow">if</span>(Event.current.keyCode == KeyCode.D &amp;&amp; (Event.current.control || Event.current.command) &amp;&amp; Event.current.alt &amp;&amp; Event.current.type == EventType.keyDown &amp;&amp; mode == Mode.Select)
<a name="l01296"></a>01296                 {
<a name="l01297"></a>01297                         backBuffer.PasteBitmap(selection.X, selection.Y, frontBuffer);
<a name="l01298"></a>01298                         animStripGUI.isDirty = <span class="keyword">true</span>;
<a name="l01299"></a>01299                         spriteSheetGUI.isDirty = <span class="keyword">true</span>;
<a name="l01300"></a>01300                         atlasTextureIsDirty = <span class="keyword">true</span>;
<a name="l01301"></a>01301                         Event.current.Use();
<a name="l01302"></a>01302                 }
<a name="l01303"></a>01303                 <span class="keywordflow">if</span>(Event.current.keyCode == KeyCode.X &amp;&amp; (Event.current.control || Event.current.command) &amp;&amp; Event.current.alt &amp;&amp; Event.current.type == EventType.keyDown &amp;&amp; mode == Mode.Select)
<a name="l01304"></a>01304                 {
<a name="l01305"></a>01305                         SavePaintUndo();
<a name="l01306"></a>01306                         RagePixelUtil.Settings.clipboard = <span class="keyword">new</span> <a class="code" href="class_rage_pixel_bitmap.html">RagePixelBitmap</a>(frontBuffer.pixels, frontBuffer.Width(), frontBuffer.Height());
<a name="l01307"></a>01307                         selectionActive = <span class="keyword">false</span>;
<a name="l01308"></a>01308                         Rect currentUV = ragePixelSprite.GetCurrentCell().uv;
<a name="l01309"></a>01309                         Rect selectionUV = <span class="keyword">new</span> Rect(
<a name="l01310"></a>01310                 currentUV.xMin + (<span class="keywordtype">float</span>)selection.X / (<span class="keywordtype">float</span>)spritesheetTexture.width,
<a name="l01311"></a>01311                 currentUV.yMin + (<span class="keywordtype">float</span>)selection.Y / (<span class="keywordtype">float</span>)spritesheetTexture.height,
<a name="l01312"></a>01312                 (<span class="keywordtype">float</span>)(selection.X2 - selection.X + 1) / (<span class="keywordtype">float</span>)spritesheetTexture.width,
<a name="l01313"></a>01313                 (<span class="keywordtype">float</span>)(selection.Y2 - selection.Y + 1) / (<span class="keywordtype">float</span>)spritesheetTexture.height
<a name="l01314"></a>01314                 );
<a name="l01315"></a>01315                         RagePixelUtil.clearPixels(spritesheetTexture, selectionUV);
<a name="l01316"></a>01316                         spritesheetTexture.Apply();
<a name="l01317"></a>01317                         atlasTextureIsDirty = <span class="keyword">true</span>;
<a name="l01318"></a>01318 
<a name="l01319"></a>01319                         selection = null;
<a name="l01320"></a>01320                         Event.current.Use();
<a name="l01321"></a>01321                 }
<a name="l01322"></a>01322                 <span class="keywordflow">if</span>(Event.current.keyCode == KeyCode.C &amp;&amp; (Event.current.control || Event.current.command) &amp;&amp; Event.current.alt &amp;&amp; Event.current.type == EventType.keyDown &amp;&amp; mode == Mode.Select)
<a name="l01323"></a>01323                 {
<a name="l01324"></a>01324                         RagePixelUtil.Settings.clipboard = <span class="keyword">new</span> <a class="code" href="class_rage_pixel_bitmap.html">RagePixelBitmap</a>(frontBuffer.pixels, frontBuffer.Width(), frontBuffer.Height());
<a name="l01325"></a>01325                         selection = null;
<a name="l01326"></a>01326                         selectionActive = <span class="keyword">false</span>;
<a name="l01327"></a>01327                         Event.current.Use();
<a name="l01328"></a>01328                 }
<a name="l01329"></a>01329                 <span class="keywordflow">if</span>(Event.current.keyCode == KeyCode.V &amp;&amp; (Event.current.control || Event.current.command) &amp;&amp; Event.current.alt &amp;&amp; Event.current.type == EventType.keyDown)
<a name="l01330"></a>01330                 {
<a name="l01331"></a>01331                         <span class="keywordflow">if</span>(RagePixelUtil.Settings.clipboard != null)
<a name="l01332"></a>01332                         {
<a name="l01333"></a>01333                                 mode = Mode.Select;
<a name="l01334"></a>01334 
<a name="l01335"></a>01335                                 SavePaintUndo();
<a name="l01336"></a>01336 
<a name="l01337"></a>01337                                 Rect spriteUV = ragePixelSprite.GetCurrentCell().uv;
<a name="l01338"></a>01338 
<a name="l01339"></a>01339                                 selection = <span class="keyword">new</span> <a class="code" href="class_rage_pixel_texel_rect.html">RagePixelTexelRect</a>(
<a name="l01340"></a>01340                     0,
<a name="l01341"></a>01341                     0,
<a name="l01342"></a>01342                     Mathf.Min(RagePixelUtil.Settings.clipboard.Width(), ragePixelSprite.GetCurrentRow().pixelSizeX),
<a name="l01343"></a>01343                     Mathf.Min(RagePixelUtil.Settings.clipboard.Height(), ragePixelSprite.GetCurrentRow().pixelSizeY)
<a name="l01344"></a>01344                     );
<a name="l01345"></a>01345 
<a name="l01346"></a>01346                                 backBuffer = GrabSprite(spriteUV);
<a name="l01347"></a>01347                                 frontBuffer = RagePixelUtil.Settings.clipboard;
<a name="l01348"></a>01348 
<a name="l01349"></a>01349                                 frontBufferPosition = <span class="keyword">new</span> <a class="code" href="class_rage_pixel_texel.html">RagePixelTexel</a>(0, 0);
<a name="l01350"></a>01350                                 frontBufferDragStartPosition = <span class="keyword">new</span> <a class="code" href="class_rage_pixel_texel.html">RagePixelTexel</a>(0, 0);
<a name="l01351"></a>01351 
<a name="l01352"></a>01352                                 PasteBitmapToSpritesheetAlpha(frontBufferPosition, spriteUV, frontBuffer);
<a name="l01353"></a>01353 
<a name="l01354"></a>01354                                 selectionActive = <span class="keyword">true</span>;
<a name="l01355"></a>01355                                 spritesheetTexture.Apply();
<a name="l01356"></a>01356 
<a name="l01357"></a>01357                                 Event.current.Use();
<a name="l01358"></a>01358                         }
<a name="l01359"></a>01359                 }
<a name="l01360"></a>01360         }
<a name="l01361"></a>01361 
<a name="l01362"></a>01362         <span class="keyword">public</span> <span class="keywordtype">void</span> HandleCameraWarnings()
<a name="l01363"></a>01363         {
<a name="l01364"></a>01364                 <span class="keywordtype">int</span> guiPosY = 0;
<a name="l01365"></a>01365                 <span class="keywordtype">int</span> guiPosX = 0;
<a name="l01366"></a>01366 
<a name="l01367"></a>01367                 <span class="keywordflow">if</span>(RagePixelUtil.Settings.showCameraWarnings)
<a name="l01368"></a>01368                 {
<a name="l01369"></a>01369             
<a name="l01370"></a>01370                         <span class="keywordflow">if</span>(!sceneCamera.isOrthoGraphic || !SceneCameraFacingCorrectly())
<a name="l01371"></a>01371                         {
<a name="l01372"></a>01372                 
<a name="l01373"></a>01373                                 guiPosY = 5;
<a name="l01374"></a>01374                                 <span class="keywordflow">if</span>(!sceneCamera.isOrthoGraphic)
<a name="l01375"></a>01375                                 {
<a name="l01376"></a>01376                                         guiPosX = (int)sceneCamera.pixelWidth / 2 - 90;
<a name="l01377"></a>01377                                         GUI.color = <span class="keyword">new</span> Color(1f, 0.33f, 0.33f);
<a name="l01378"></a>01378                                         GUI.Label(<span class="keyword">new</span> Rect(guiPosX, guiPosY, sceneCamera.pixelWidth, 20), <span class="stringliteral">&quot;WARNING: sceneview camera is perspective&quot;</span>);
<a name="l01379"></a>01379                                         guiPosY += 15;
<a name="l01380"></a>01380                                 }
<a name="l01381"></a>01381                                 <span class="keywordflow">if</span>(!SceneCameraFacingCorrectly())
<a name="l01382"></a>01382                                 {
<a name="l01383"></a>01383                                         guiPosX = (int)sceneCamera.pixelWidth / 2 - 105;
<a name="l01384"></a>01384                                         GUI.color = <span class="keyword">new</span> Color(1f, 0.33f, 0.33f);
<a name="l01385"></a>01385                                         GUI.Label(<span class="keyword">new</span> Rect(guiPosX, guiPosY, sceneCamera.pixelWidth, 20), <span class="stringliteral">&quot;WARNING: Sceneview camera orientation != BACK&quot;</span>);
<a name="l01386"></a>01386                                 }
<a name="l01387"></a>01387 
<a name="l01388"></a>01388                                 guiPosX = (int)sceneCamera.pixelWidth - 180;
<a name="l01389"></a>01389                                 guiPosY = 42;
<a name="l01390"></a>01390                                 GUI.Label(<span class="keyword">new</span> Rect(guiPosX, guiPosY, sceneCamera.pixelWidth, 20), <span class="stringliteral">&quot;Right-click --&gt;&quot;</span>);
<a name="l01391"></a>01391                                 GUI.color = Color.white;
<a name="l01392"></a>01392                         }
<a name="l01393"></a>01393                 }
<a name="l01394"></a>01394         }
<a name="l01395"></a>01395 
<a name="l01396"></a>01396         <span class="keyword">public</span> <span class="keywordtype">void</span> OnSelected()
<a name="l01397"></a>01397         {
<a name="l01398"></a>01398                 <span class="keywordflow">if</span>(ragePixelSprite.spriteSheet == null &amp;&amp; !RagePixelUtil.Settings.initialSpritesheetGenerated)
<a name="l01399"></a>01399                 {
<a name="l01400"></a>01400                         InitializeEmptyProject();
<a name="l01401"></a>01401                 }
<a name="l01402"></a>01402 
<a name="l01403"></a>01403                 mode = Mode.Default;
<a name="l01404"></a>01404                 Tools.current = Tool.Move;
<a name="l01405"></a>01405         }
<a name="l01406"></a>01406 
<a name="l01407"></a>01407         <span class="keyword">public</span> <span class="keywordtype">void</span> InitializeEmptyProject()
<a name="l01408"></a>01408         {
<a name="l01409"></a>01409                 ragePixelSprite.transform.localScale = <span class="keyword">new</span> Vector3(1f, 1f, 1f);
<a name="l01410"></a>01410                 List&lt;UnityEngine.Object&gt; assets = RagePixelUtil.allAssets;
<a name="l01411"></a>01411 
<a name="l01412"></a>01412                 <span class="keywordtype">int</span> count = 0;
<a name="l01413"></a>01413                 <span class="keywordflow">foreach</span>(UnityEngine.Object asset in assets)
<a name="l01414"></a>01414                 {
<a name="l01415"></a>01415                         <span class="keywordflow">if</span>(asset is <a class="code" href="class_rage_pixel_sprite_sheet.html">RagePixelSpriteSheet</a>)
<a name="l01416"></a>01416                         {
<a name="l01417"></a>01417                                 <span class="keywordflow">if</span>(!asset.name.Equals(<span class="stringliteral">&quot;BasicFont&quot;</span>))
<a name="l01418"></a>01418                                 {
<a name="l01419"></a>01419                                         count++;
<a name="l01420"></a>01420                                 }
<a name="l01421"></a>01421                         }
<a name="l01422"></a>01422                 }
<a name="l01423"></a>01423 
<a name="l01424"></a>01424                 <span class="keywordflow">if</span>(count == 0)
<a name="l01425"></a>01425                 {
<a name="l01426"></a>01426                         <span class="keywordflow">if</span>(EditorUtility.DisplayDialog(<span class="stringliteral">&quot;RagePixel Spritesheet&quot;</span>, <span class="stringliteral">&quot;Create new RagePixel spritesheet automatically?&quot;</span>, <span class="stringliteral">&quot;Create&quot;</span>, <span class="stringliteral">&quot;Cancel&quot;</span>))
<a name="l01427"></a>01427                         {
<a name="l01428"></a>01428                                 ragePixelSprite.spriteSheet = RagePixelUtil.CreateNewSpritesheet();
<a name="l01429"></a>01429                                 ragePixelSprite.currentRowKey = ragePixelSprite.spriteSheet.rows[0].key;
<a name="l01430"></a>01430                                 ragePixelSprite.currentCellKey = ragePixelSprite.GetCurrentRow().cells[0].key;
<a name="l01431"></a>01431                                 ragePixelSprite.refreshMesh();
<a name="l01432"></a>01432                                 RagePixelUtil.Settings.initialSpritesheetGenerated = <span class="keyword">true</span>;
<a name="l01433"></a>01433                         }
<a name="l01434"></a>01434 
<a name="l01435"></a>01435                         <span class="keywordflow">if</span>(Camera.mainCamera != null)
<a name="l01436"></a>01436                         {
<a name="l01437"></a>01437                                 <span class="keywordflow">if</span>(Camera.mainCamera.GetComponent(typeof(<a class="code" href="class_rage_pixel_camera.html">RagePixelCamera</a>)) == null)
<a name="l01438"></a>01438                                 {
<a name="l01439"></a>01439                                         <span class="keywordflow">if</span>(EditorUtility.DisplayDialog(<span class="stringliteral">&quot;RagePixel Camera&quot;</span>, <span class="stringliteral">&quot;Setup RagePixel camera automatically?\nCamera resolution = 1024x768\nPixel size = 2.&quot;</span>, <span class="stringliteral">&quot;Do it&quot;</span>, <span class="stringliteral">&quot;Cancel&quot;</span>))
<a name="l01440"></a>01440                                         {
<a name="l01441"></a>01441                                                 <a class="code" href="class_rage_pixel_camera.html">RagePixelCamera</a> ragecam = Camera.mainCamera.gameObject.AddComponent(typeof(<a class="code" href="class_rage_pixel_camera.html">RagePixelCamera</a>)) as <a class="code" href="class_rage_pixel_camera.html">RagePixelCamera</a>;
<a name="l01442"></a>01442                                                 ragecam.resolutionPixelWidth = (int)1024;
<a name="l01443"></a>01443                                                 ragecam.resolutionPixelHeight = (int)768;
<a name="l01444"></a>01444 
<a name="l01445"></a>01445                                                 ragecam.pixelSize = 2;
<a name="l01446"></a>01446                                                 RagePixelUtil.ResetCamera(ragecam);
<a name="l01447"></a>01447 
<a name="l01448"></a>01448                                                 ragePixelSprite.transform.position = ragecam.transform.position * 0.2f;
<a name="l01449"></a>01449                                                 ragePixelSprite.transform.position = <span class="keyword">new</span> Vector3(ragePixelSprite.transform.position.x, ragePixelSprite.transform.position.y, 0f);
<a name="l01450"></a>01450                                         }
<a name="l01451"></a>01451                                 }
<a name="l01452"></a>01452                         }
<a name="l01453"></a>01453 
<a name="l01454"></a>01454                 }
<a name="l01455"></a>01455                 <span class="keywordflow">else</span>
<a name="l01456"></a>01456                 {
<a name="l01457"></a>01457                         <span class="comment">/*</span>
<a name="l01458"></a>01458 <span class="comment">            ragePixelText.spriteSheet = sheet;</span>
<a name="l01459"></a>01459 <span class="comment">            ragePixelText.currentRowKey = ragePixelText.spriteSheet.rows[0].key;</span>
<a name="l01460"></a>01460 <span class="comment">            ragePixelText.currentCellKey = ragePixelText.GetCurrentRow().cells[0].key;</span>
<a name="l01461"></a>01461 <span class="comment">            ragePixelText.refreshMesh();</span>
<a name="l01462"></a>01462 <span class="comment">            */</span>
<a name="l01463"></a>01463                 }
<a name="l01464"></a>01464         }
<a name="l01465"></a>01465 
<a name="l01466"></a>01466         <span class="keyword">public</span> <span class="keywordtype">void</span> DrawGizmos()
<a name="l01467"></a>01467         {
<a name="l01468"></a>01468                 DrawSpriteBoundsGizmo();
<a name="l01469"></a>01469 
<a name="l01470"></a>01470                 <span class="keywordflow">if</span>(showGrid9Gizmo)
<a name="l01471"></a>01471                 {
<a name="l01472"></a>01472                         DrawGrid9Gizmo();
<a name="l01473"></a>01473                 }
<a name="l01474"></a>01474         }
<a name="l01475"></a>01475 
<a name="l01476"></a>01476         <span class="keyword">public</span> <span class="keywordtype">void</span> DrawGrid9Gizmo()
<a name="l01477"></a>01477         {
<a name="l01478"></a>01478                 Handles.color = <span class="keyword">new</span> Color(0f, 0f, 0f, 0.75f);
<a name="l01479"></a>01479                 Handles.DrawLine(
<a name="l01480"></a>01480             worldToSceneScreenPoint(
<a name="l01481"></a>01481                 ragePixelSprite.transform.TransformPoint(GetPivotOffset() + <span class="keyword">new</span> Vector3(ragePixelSprite.grid9Left, -3f, 0f))
<a name="l01482"></a>01482                 ),
<a name="l01483"></a>01483             worldToSceneScreenPoint(
<a name="l01484"></a>01484                 ragePixelSprite.transform.TransformPoint(GetPivotOffset() + <span class="keyword">new</span> Vector3(ragePixelSprite.grid9Left, ragePixelSprite.pixelSizeY + 3f, 0f))
<a name="l01485"></a>01485                 )
<a name="l01486"></a>01486             );
<a name="l01487"></a>01487                 Handles.DrawLine(
<a name="l01488"></a>01488             worldToSceneScreenPoint(
<a name="l01489"></a>01489                 ragePixelSprite.transform.TransformPoint(GetPivotOffset() + <span class="keyword">new</span> Vector3(ragePixelSprite.pixelSizeX - ragePixelSprite.grid9Right, -3f, 0f))
<a name="l01490"></a>01490                 ),
<a name="l01491"></a>01491             worldToSceneScreenPoint(
<a name="l01492"></a>01492                 ragePixelSprite.transform.TransformPoint(GetPivotOffset() + <span class="keyword">new</span> Vector3(ragePixelSprite.pixelSizeX - ragePixelSprite.grid9Right, ragePixelSprite.pixelSizeY + 3f, 0f))
<a name="l01493"></a>01493                 )
<a name="l01494"></a>01494             );
<a name="l01495"></a>01495                 Handles.DrawLine(
<a name="l01496"></a>01496             worldToSceneScreenPoint(
<a name="l01497"></a>01497                 ragePixelSprite.transform.TransformPoint(GetPivotOffset() + <span class="keyword">new</span> Vector3(-3f, ragePixelSprite.grid9Bottom, 0f))
<a name="l01498"></a>01498                 ),
<a name="l01499"></a>01499             worldToSceneScreenPoint(
<a name="l01500"></a>01500                 ragePixelSprite.transform.TransformPoint(GetPivotOffset() + <span class="keyword">new</span> Vector3(ragePixelSprite.pixelSizeX + 3f, ragePixelSprite.grid9Bottom, 0f))
<a name="l01501"></a>01501                 )
<a name="l01502"></a>01502             );
<a name="l01503"></a>01503                 Handles.DrawLine(
<a name="l01504"></a>01504             worldToSceneScreenPoint(
<a name="l01505"></a>01505                 ragePixelSprite.transform.TransformPoint(GetPivotOffset() + <span class="keyword">new</span> Vector3(-3f, ragePixelSprite.pixelSizeY - ragePixelSprite.grid9Top, 0f))
<a name="l01506"></a>01506                 ),
<a name="l01507"></a>01507             worldToSceneScreenPoint(
<a name="l01508"></a>01508                 ragePixelSprite.transform.TransformPoint(GetPivotOffset() + <span class="keyword">new</span> Vector3(ragePixelSprite.pixelSizeX + 3f, ragePixelSprite.pixelSizeY - ragePixelSprite.grid9Top, 0f))
<a name="l01509"></a>01509                 )
<a name="l01510"></a>01510             );
<a name="l01511"></a>01511                 Handles.color = <span class="keyword">new</span> Color(1f, 1f, 1f, 1f);
<a name="l01512"></a>01512         }
<a name="l01513"></a>01513 
<a name="l01514"></a>01514         <span class="keyword">public</span> <span class="keywordtype">void</span> DrawSpriteBoundsGizmo()
<a name="l01515"></a>01515         {
<a name="l01516"></a>01516                 Vector3 offset = <span class="keyword">new</span> Vector3();
<a name="l01517"></a>01517                 Color spriteGizmoCol = Color.white;
<a name="l01518"></a>01518 
<a name="l01519"></a>01519                 <span class="keywordflow">switch</span>(mode)
<a name="l01520"></a>01520                 {
<a name="l01521"></a>01521                 <span class="keywordflow">case</span> (Mode.Resize):
<a name="l01522"></a>01522                         spriteGizmoCol = <span class="keyword">new</span> Color(0.7f, 1f, 0.7f, 0.3f);
<a name="l01523"></a>01523                         offset.x = ragePixelSprite.GetCurrentRow().newPixelSizeX;
<a name="l01524"></a>01524                         offset.y = ragePixelSprite.GetCurrentRow().newPixelSizeY;
<a name="l01525"></a>01525 
<a name="l01526"></a>01526                         <span class="keywordflow">break</span>;
<a name="l01527"></a>01527                 <span class="keywordflow">case</span> (Mode.Default):
<a name="l01528"></a>01528                 <span class="keywordflow">case</span> (Mode.Fill):
<a name="l01529"></a>01529                 <span class="keywordflow">case</span> (Mode.Pen):
<a name="l01530"></a>01530                 <span class="keywordflow">case</span> (Mode.Scale):
<a name="l01531"></a>01531                 <span class="keywordflow">case</span> (Mode.Select):
<a name="l01532"></a>01532                         DrawSelectionBox();
<a name="l01533"></a>01533 
<a name="l01534"></a>01534                         spriteGizmoCol = <span class="keyword">new</span> Color(1f, 1f, 1f, 0.2f);
<a name="l01535"></a>01535                         offset.x = ragePixelSprite.pixelSizeX;
<a name="l01536"></a>01536                         offset.y = ragePixelSprite.pixelSizeY;
<a name="l01537"></a>01537                         <span class="keywordflow">break</span>;
<a name="l01538"></a>01538                 }
<a name="l01539"></a>01539                 
<a name="l01540"></a>01540                 Vector3[] spriteGizmoVerts = <span class="keyword">new</span> Vector3[4];
<a name="l01541"></a>01541 
<a name="l01542"></a>01542                 spriteGizmoVerts[0] = worldToSceneScreenPoint(ragePixelSprite.transform.TransformPoint(GetPivotOffset() + <span class="keyword">new</span> Vector3(0f, 0f, 0f)));
<a name="l01543"></a>01543                 spriteGizmoVerts[1] = worldToSceneScreenPoint(ragePixelSprite.transform.TransformPoint(GetPivotOffset() + <span class="keyword">new</span> Vector3(0f, offset.y, 0f)));
<a name="l01544"></a>01544                 spriteGizmoVerts[2] = worldToSceneScreenPoint(ragePixelSprite.transform.TransformPoint(GetPivotOffset() + <span class="keyword">new</span> Vector3(offset.x, offset.y, 0f)));
<a name="l01545"></a>01545                 spriteGizmoVerts[3] = worldToSceneScreenPoint(ragePixelSprite.transform.TransformPoint(GetPivotOffset() + <span class="keyword">new</span> Vector3(offset.x, 0f, 0f)));
<a name="l01546"></a>01546 
<a name="l01547"></a>01547                 Handles.DrawSolidRectangleWithOutline(spriteGizmoVerts, <span class="keyword">new</span> Color(0f, 0f, 0f, 0f), spriteGizmoCol);
<a name="l01548"></a>01548         }
<a name="l01549"></a>01549 
<a name="l01550"></a>01550         <span class="keyword">public</span> <span class="keywordtype">void</span> cancelColorReplacing()
<a name="l01551"></a>01551         {
<a name="l01552"></a>01552                 spriteSheetGUI.spriteSheetTexture.SetPixels32(colorReplaceBuffer);
<a name="l01553"></a>01553                 spriteSheetGUI.spriteSheetTexture.Apply();
<a name="l01554"></a>01554                 saveTexture();
<a name="l01555"></a>01555         }
<a name="l01556"></a>01556 
<a name="l01557"></a>01557         <span class="keyword">public</span> <span class="keywordtype">void</span> SavePaintUndo()
<a name="l01558"></a>01558         {
<a name="l01559"></a>01559                 <span class="keywordflow">if</span>(!paintUndoSaved)
<a name="l01560"></a>01560                 {
<a name="l01561"></a>01561                         paintUndoSaved = <span class="keyword">true</span>;
<a name="l01562"></a>01562                         ragePixelSprite.spriteSheet.saveUndo(ragePixelSprite.GetCurrentCell());
<a name="l01563"></a>01563                 }
<a name="l01564"></a>01564         }
<a name="l01565"></a>01565 
<a name="l01566"></a>01566         <span class="keyword">public</span> <span class="keywordtype">void</span> DoPaintUndo()
<a name="l01567"></a>01567         {
<a name="l01568"></a>01568                 paintUndoSaved = <span class="keyword">false</span>;
<a name="l01569"></a>01569                 ragePixelSprite.spriteSheet.DoUndo(ragePixelSprite.GetCurrentCell());
<a name="l01570"></a>01570                 EditorUtility.SetDirty(ragePixelSprite);
<a name="l01571"></a>01571         }
<a name="l01572"></a>01572 
<a name="l01573"></a>01573         <span class="keyword">public</span> <span class="keywordtype">void</span> DrawSelectionBox()
<a name="l01574"></a>01574         {
<a name="l01575"></a>01575                 <span class="keywordflow">if</span>(selection != null)
<a name="l01576"></a>01576                 {
<a name="l01577"></a>01577                         Vector3[] verts = <span class="keyword">new</span> Vector3[4];
<a name="l01578"></a>01578                         <span class="keywordflow">if</span>(!selectionActive)
<a name="l01579"></a>01579                         {
<a name="l01580"></a>01580                                 verts[0] = worldToSceneScreenPoint(TexelCoordsToWorld(spritesheetTexture, ragePixelSprite.transform, <span class="keyword">new</span> <a class="code" href="class_rage_pixel_texel.html">RagePixelTexel</a>(selection.X, selection.Y)));
<a name="l01581"></a>01581                                 verts[1] = worldToSceneScreenPoint(TexelCoordsToWorld(spritesheetTexture, ragePixelSprite.transform, <span class="keyword">new</span> <a class="code" href="class_rage_pixel_texel.html">RagePixelTexel</a>(selection.X + selection.Width(), selection.Y)));
<a name="l01582"></a>01582                                 verts[2] = worldToSceneScreenPoint(TexelCoordsToWorld(spritesheetTexture, ragePixelSprite.transform, <span class="keyword">new</span> <a class="code" href="class_rage_pixel_texel.html">RagePixelTexel</a>(selection.X + selection.Width(), selection.Y + selection.Height())));
<a name="l01583"></a>01583                                 verts[3] = worldToSceneScreenPoint(TexelCoordsToWorld(spritesheetTexture, ragePixelSprite.transform, <span class="keyword">new</span> <a class="code" href="class_rage_pixel_texel.html">RagePixelTexel</a>(selection.X, selection.Y + selection.Height())));
<a name="l01584"></a>01584                                 Handles.DrawSolidRectangleWithOutline(verts, <span class="keyword">new</span> Color(0f, 0f, 0f, 0.04f), <span class="keyword">new</span> Color(0f, 0f, 0f, 0.5f));
<a name="l01585"></a>01585                         }
<a name="l01586"></a>01586                         <span class="keywordflow">else</span>
<a name="l01587"></a>01587                         {
<a name="l01588"></a>01588                                 verts[0] = worldToSceneScreenPoint(TexelCoordsToWorld(spritesheetTexture, ragePixelSprite.transform, <span class="keyword">new</span> <a class="code" href="class_rage_pixel_texel.html">RagePixelTexel</a>(frontBufferPosition.X, frontBufferPosition.Y)));
<a name="l01589"></a>01589                                 verts[1] = worldToSceneScreenPoint(TexelCoordsToWorld(spritesheetTexture, ragePixelSprite.transform, <span class="keyword">new</span> <a class="code" href="class_rage_pixel_texel.html">RagePixelTexel</a>(frontBufferPosition.X + selection.Width(), frontBufferPosition.Y)));
<a name="l01590"></a>01590                                 verts[2] = worldToSceneScreenPoint(TexelCoordsToWorld(spritesheetTexture, ragePixelSprite.transform, <span class="keyword">new</span> <a class="code" href="class_rage_pixel_texel.html">RagePixelTexel</a>(frontBufferPosition.X + selection.Width(), frontBufferPosition.Y + selection.Height())));
<a name="l01591"></a>01591                                 verts[3] = worldToSceneScreenPoint(TexelCoordsToWorld(spritesheetTexture, ragePixelSprite.transform, <span class="keyword">new</span> <a class="code" href="class_rage_pixel_texel.html">RagePixelTexel</a>(frontBufferPosition.X, frontBufferPosition.Y + selection.Height())));
<a name="l01592"></a>01592                                 Handles.DrawSolidRectangleWithOutline(verts, <span class="keyword">new</span> Color(1f, 1f, 1f, 0.04f), <span class="keyword">new</span> Color(1f, 1f, 1f, 0.5f));
<a name="l01593"></a>01593                         }
<a name="l01594"></a>01594                 }
<a name="l01595"></a>01595         }
<a name="l01596"></a>01596 
<a name="l01597"></a>01597         <span class="keyword">public</span> <span class="keywordtype">void</span> HandleInspectorSpritesheetRemove()
<a name="l01598"></a>01598         {
<a name="l01599"></a>01599                 <span class="keywordflow">if</span>(ragePixelSprite.spriteSheet.rows.Length &gt; 1)
<a name="l01600"></a>01600                 {
<a name="l01601"></a>01601                         <span class="keywordflow">if</span>(EditorUtility.DisplayDialog(<span class="stringliteral">&quot;Delete selected sprite?&quot;</span>, <span class="stringliteral">&quot;Are you sure?&quot;</span>, <span class="stringliteral">&quot;Delete&quot;</span>, <span class="stringliteral">&quot;Cancel&quot;</span>))
<a name="l01602"></a>01602                         {
<a name="l01603"></a>01603                                 <span class="keywordtype">int</span> index = ragePixelSprite.spriteSheet.GetIndex(ragePixelSprite.GetCurrentRow().key);
<a name="l01604"></a>01604                                 ragePixelSprite.spriteSheet.RemoveRowByKey(ragePixelSprite.GetCurrentRow().key);
<a name="l01605"></a>01605                                 <span class="keywordflow">if</span>(index &gt; 0)
<a name="l01606"></a>01606                                 {
<a name="l01607"></a>01607                                         ragePixelSprite.currentRowKey = ragePixelSprite.spriteSheet.rows[index - 1].key;
<a name="l01608"></a>01608                                 }
<a name="l01609"></a>01609                                 <span class="keywordflow">else</span>
<a name="l01610"></a>01610                                 {
<a name="l01611"></a>01611                                         ragePixelSprite.currentRowKey = ragePixelSprite.spriteSheet.rows[0].key;
<a name="l01612"></a>01612                                 }
<a name="l01613"></a>01613                                 RagePixelUtil.RebuildAtlas(ragePixelSprite.spriteSheet, <span class="keyword">false</span>, <span class="stringliteral">&quot;RemoveRow&quot;</span>);
<a name="l01614"></a>01614                                 spriteSheetGUI.isDirty = <span class="keyword">true</span>;
<a name="l01615"></a>01615                                 animStripGUI.isDirty = <span class="keyword">true</span>;
<a name="l01616"></a>01616                         }
<a name="l01617"></a>01617                 }
<a name="l01618"></a>01618         }
<a name="l01619"></a>01619 
<a name="l01620"></a>01620         <span class="keyword">public</span> <span class="keywordtype">void</span> RefreshPreviewLayer()
<a name="l01621"></a>01621         {
<a name="l01622"></a>01622                 <span class="keywordflow">if</span>(meshRenderer != null)
<a name="l01623"></a>01623                 {
<a name="l01624"></a>01624                         <span class="keywordflow">if</span>(meshRenderer.sharedMaterials.Length == 1)
<a name="l01625"></a>01625                         {
<a name="l01626"></a>01626                                 Material[] materials = <span class="keyword">new</span> Material[2];
<a name="l01627"></a>01627                                 Material layerMaterial = <span class="keyword">new</span> Material(Shader.Find(<span class="stringliteral">&quot;RagePixel/Basic&quot;</span>));
<a name="l01628"></a>01628 
<a name="l01629"></a>01629                                 Texture2D texture = <span class="keyword">new</span> Texture2D(ragePixelSprite.GetCurrentRow().pixelSizeX, ragePixelSprite.GetCurrentRow().pixelSizeY);
<a name="l01630"></a>01630                                 texture.SetPixel(0, 0, <span class="keyword">new</span> Color(0f, 1f, 0f, 1f));
<a name="l01631"></a>01631                                 layerMaterial.SetTexture(<span class="stringliteral">&quot;_MainTex&quot;</span>, texture);
<a name="l01632"></a>01632                                 materials[0] = meshRenderer.sharedMaterials[0];
<a name="l01633"></a>01633                                 materials[1] = layerMaterial;
<a name="l01634"></a>01634 
<a name="l01635"></a>01635                                 meshRenderer.sharedMaterials = materials;
<a name="l01636"></a>01636                         }
<a name="l01637"></a>01637                 }
<a name="l01638"></a>01638         }
<a name="l01639"></a>01639 
<a name="l01640"></a>01640         <span class="keyword">public</span> <span class="keywordtype">void</span> FloodFill(Color oldColor, Color color, Texture2D tex, <span class="keywordtype">int</span> fX, <span class="keywordtype">int</span> fY, <span class="keywordtype">int</span> minX, <span class="keywordtype">int</span> minY, <span class="keywordtype">int</span> maxX, <span class="keywordtype">int</span> maxY)
<a name="l01641"></a>01641         {
<a name="l01642"></a>01642                 tex.SetPixel(fX, fY, color);
<a name="l01643"></a>01643                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> y = Mathf.Max(fY - 1, minY); y &lt;= Mathf.Min(fY + 1, maxY); y++)
<a name="l01644"></a>01644                 {
<a name="l01645"></a>01645                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> x = Mathf.Max(fX - 1, minX); x &lt;= Mathf.Min(fX + 1, maxX); x++)
<a name="l01646"></a>01646                         {
<a name="l01647"></a>01647                                 <span class="keywordflow">if</span>(x == fX || y == fY)
<a name="l01648"></a>01648                                 {
<a name="l01649"></a>01649                                         <span class="keywordflow">if</span>(tex.GetPixel(x, y).Equals(oldColor))
<a name="l01650"></a>01650                                         {
<a name="l01651"></a>01651                                                 FloodFill(oldColor, color, tex, x, y, minX, minY, maxX, maxY);
<a name="l01652"></a>01652                                         }
<a name="l01653"></a>01653                                 }
<a name="l01654"></a>01654                         }
<a name="l01655"></a>01655                 }
<a name="l01656"></a>01656         }
<a name="l01657"></a>01657         
<a name="l01658"></a>01658         <span class="keyword">public</span> Color[] getScaledImage(Texture2D src, <span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height, Color bgColor)
<a name="l01659"></a>01659         {
<a name="l01660"></a>01660                 Color[] pixels = <span class="keyword">new</span> Color[width * height];
<a name="l01661"></a>01661 
<a name="l01662"></a>01662                 <span class="keywordtype">float</span> ratioX = (float)src.width / (<span class="keywordtype">float</span>)width;
<a name="l01663"></a>01663                 <span class="keywordtype">float</span> ratioY = (float)src.height / (<span class="keywordtype">float</span>)height;
<a name="l01664"></a>01664 
<a name="l01665"></a>01665                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> y = 0; y &lt; height; y++)
<a name="l01666"></a>01666                 {
<a name="l01667"></a>01667                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> x = 0; x &lt; width; x++)
<a name="l01668"></a>01668                         {
<a name="l01669"></a>01669                                 <span class="keywordtype">int</span> srcX = Mathf.Clamp(Mathf.FloorToInt((<span class="keywordtype">float</span>)x * ratioX), 0, src.width - 1);
<a name="l01670"></a>01670                                 <span class="keywordtype">int</span> srcY = Mathf.Clamp(Mathf.FloorToInt((<span class="keywordtype">float</span>)y * ratioY), 0, src.height - 1);
<a name="l01671"></a>01671                                 Color pixel = src.GetPixel(srcX, srcY);
<a name="l01672"></a>01672                                 <span class="keywordflow">if</span>(pixel.a &gt;= 0.99f)
<a name="l01673"></a>01673                                 {
<a name="l01674"></a>01674                                         pixels[x + y * width] = pixel;
<a name="l01675"></a>01675                                 }
<a name="l01676"></a>01676                                 <span class="keywordflow">else</span>
<a name="l01677"></a>01677                                 {
<a name="l01678"></a>01678                                         pixels[x + y * width] = pixel * pixel.a + bgColor * (1f - pixel.a);
<a name="l01679"></a>01679                                 }
<a name="l01680"></a>01680                         }
<a name="l01681"></a>01681                 }
<a name="l01682"></a>01682                 <span class="keywordflow">return</span> pixels;
<a name="l01683"></a>01683         }
<a name="l01684"></a>01684 
<a name="l01685"></a>01685         <span class="keyword">public</span> <span class="keywordtype">void</span> ShowDebugInfo()
<a name="l01686"></a>01686         {       
<a name="l01687"></a>01687 
<a name="l01688"></a>01688                 <span class="keywordflow">if</span>(meshFilter != null)
<a name="l01689"></a>01689                 {
<a name="l01690"></a>01690                         Mesh m = meshFilter.sharedMesh;
<a name="l01691"></a>01691 
<a name="l01692"></a>01692                         <span class="keywordflow">if</span>(m != null)
<a name="l01693"></a>01693                         {
<a name="l01694"></a>01694                                 Handles.BeginGUI();
<a name="l01695"></a>01695                                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; m.vertexCount; i++)
<a name="l01696"></a>01696                                 {
<a name="l01697"></a>01697                                         <span class="comment">//float screenHeight = sceneCamera.orthographicSize * 2f; </span>
<a name="l01698"></a>01698                     
<a name="l01699"></a>01699                                         Vector3 screenPos = worldToSceneScreenPoint(ragePixelSprite.transform.TransformPoint(m.vertices[i]));
<a name="l01700"></a>01700 
<a name="l01701"></a>01701                                         Rect r = <span class="keyword">new</span> Rect(screenPos.x + 5, screenPos.y, 200, 20);
<a name="l01702"></a>01702                                         GUI.Label(r, <span class="stringliteral">&quot;POS:&quot;</span> + m.vertices[i].ToString());
<a name="l01703"></a>01703                                         Rect r2 = <span class="keyword">new</span> Rect(screenPos.x + 5, screenPos.y + 12, 200, 20);
<a name="l01704"></a>01704                                         GUI.Label(r2, <span class="stringliteral">&quot;UV: &quot;</span> + m.uv[i].x.ToString() + <span class="stringliteral">&quot;,&quot;</span> + m.uv[i].y.ToString());
<a name="l01705"></a>01705                                 }
<a name="l01706"></a>01706                                 Handles.EndGUI();
<a name="l01707"></a>01707                         }
<a name="l01708"></a>01708                         <span class="keywordflow">else</span>
<a name="l01709"></a>01709                         {
<a name="l01710"></a>01710 
<a name="l01711"></a>01711                         }
<a name="l01712"></a>01712                 }
<a name="l01713"></a>01713         }
<a name="l01714"></a>01714 
<a name="l01715"></a>01715         <span class="keyword">public</span> <a class="code" href="class_rage_pixel_texel.html">RagePixelTexel</a> WorldToTexelCoords(Texture2D tex, Transform t, Vector3 worldPos)
<a name="l01716"></a>01716         {
<a name="l01717"></a>01717                 <a class="code" href="class_rage_pixel_texel.html">RagePixelTexel</a> coords = <span class="keyword">new</span> <a class="code" href="class_rage_pixel_texel.html">RagePixelTexel</a>();
<a name="l01718"></a>01718                 Vector3 localPos = t.InverseTransformPoint(worldPos) - GetPivotOffset();
<a name="l01719"></a>01719 
<a name="l01720"></a>01720                 <span class="keywordflow">switch</span>(ragePixelSprite.mode)
<a name="l01721"></a>01721                 {
<a name="l01722"></a>01722                 <span class="keywordflow">case</span> (<a class="code" href="class_rage_pixel_sprite.html">RagePixelSprite</a>.Mode.Default):
<a name="l01723"></a>01723                         coords.X = Mathf.FloorToInt(localPos.x);
<a name="l01724"></a>01724                         coords.Y = Mathf.FloorToInt(localPos.y);
<a name="l01725"></a>01725 
<a name="l01726"></a>01726                         <span class="keywordflow">if</span>(coords.X &gt;= 0 &amp;&amp; coords.Y &gt;= 0 &amp;&amp; coords.X &lt; ragePixelSprite.pixelSizeX &amp;&amp; coords.Y &lt; ragePixelSprite.pixelSizeY)
<a name="l01727"></a>01727                         {
<a name="l01728"></a>01728                                 coords.X = coords.X % ragePixelSprite.GetCurrentRow().pixelSizeX;
<a name="l01729"></a>01729                                 coords.Y = coords.Y % ragePixelSprite.GetCurrentRow().pixelSizeY;
<a name="l01730"></a>01730                         }
<a name="l01731"></a>01731                         <span class="keywordflow">break</span>;
<a name="l01732"></a>01732                 <span class="keywordflow">case</span> (<a class="code" href="class_rage_pixel_sprite.html">RagePixelSprite</a>.Mode.Grid9):
<a name="l01733"></a>01733                 
<a name="l01734"></a>01734                         coords.X = Mathf.FloorToInt(localPos.x);
<a name="l01735"></a>01735                         coords.Y = Mathf.FloorToInt(localPos.y);
<a name="l01736"></a>01736 
<a name="l01737"></a>01737                         <span class="keywordflow">if</span>(coords.X &gt;= 0 &amp;&amp; coords.Y &gt;= 0 &amp;&amp; coords.X &lt; ragePixelSprite.pixelSizeX &amp;&amp; coords.Y &lt; ragePixelSprite.pixelSizeY)
<a name="l01738"></a>01738                         {
<a name="l01739"></a>01739                                 <span class="keywordflow">if</span>(coords.X &lt; ragePixelSprite.grid9Left)
<a name="l01740"></a>01740                                 {
<a name="l01741"></a>01741                                         <span class="comment">//noop</span>
<a name="l01742"></a>01742                                 }
<a name="l01743"></a>01743                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(coords.X &gt;= ragePixelSprite.pixelSizeX - ragePixelSprite.grid9Right)
<a name="l01744"></a>01744                                 {
<a name="l01745"></a>01745                                         coords.X = ragePixelSprite.GetCurrentRow().pixelSizeX - (ragePixelSprite.pixelSizeX - coords.X);
<a name="l01746"></a>01746                                 }
<a name="l01747"></a>01747                                 <span class="keywordflow">else</span>
<a name="l01748"></a>01748                                 {
<a name="l01749"></a>01749                                         coords.X = ragePixelSprite.grid9Left + (coords.X - ragePixelSprite.grid9Left) % (ragePixelSprite.GetCurrentRow().pixelSizeX - ragePixelSprite.grid9Left - ragePixelSprite.grid9Right);
<a name="l01750"></a>01750                                 }
<a name="l01751"></a>01751 
<a name="l01752"></a>01752                                 <span class="keywordflow">if</span>(coords.Y &lt; ragePixelSprite.grid9Bottom)
<a name="l01753"></a>01753                                 {
<a name="l01754"></a>01754                                         <span class="comment">//noop</span>
<a name="l01755"></a>01755                                 }
<a name="l01756"></a>01756                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(coords.Y &gt;= ragePixelSprite.pixelSizeY - ragePixelSprite.grid9Top)
<a name="l01757"></a>01757                                 {
<a name="l01758"></a>01758                                         coords.Y = ragePixelSprite.GetCurrentRow().pixelSizeY - (ragePixelSprite.pixelSizeY - coords.Y);
<a name="l01759"></a>01759                                 }
<a name="l01760"></a>01760                                 <span class="keywordflow">else</span>
<a name="l01761"></a>01761                                 {
<a name="l01762"></a>01762                                         coords.Y = ragePixelSprite.grid9Bottom + (coords.Y - ragePixelSprite.grid9Bottom) % (ragePixelSprite.GetCurrentRow().pixelSizeY - ragePixelSprite.grid9Top - ragePixelSprite.grid9Bottom);
<a name="l01763"></a>01763                                 }
<a name="l01764"></a>01764                         }
<a name="l01765"></a>01765                         <span class="keywordflow">break</span>;
<a name="l01766"></a>01766                 }
<a name="l01767"></a>01767         
<a name="l01768"></a>01768         
<a name="l01769"></a>01769                 <span class="keywordflow">return</span> coords;
<a name="l01770"></a>01770         }
<a name="l01771"></a>01771 
<a name="l01772"></a>01772         <span class="keyword">public</span> Vector3 GetPivotOffset()
<a name="l01773"></a>01773         {
<a name="l01774"></a>01774                 Vector3 pivotOffset = <span class="keyword">new</span> Vector3();
<a name="l01775"></a>01775                 <span class="keywordflow">switch</span>(mode)
<a name="l01776"></a>01776                 {
<a name="l01777"></a>01777                 <span class="keywordflow">case</span> (Mode.Resize):
<a name="l01778"></a>01778                         <span class="keywordflow">switch</span>(ragePixelSprite.pivotMode)
<a name="l01779"></a>01779                         {
<a name="l01780"></a>01780                         <span class="keywordflow">case</span> (<a class="code" href="class_rage_pixel_sprite.html">RagePixelSprite</a>.PivotMode.BottomLeft):
<a name="l01781"></a>01781                                 pivotOffset.x = 0f;
<a name="l01782"></a>01782                                 pivotOffset.y = 0f;
<a name="l01783"></a>01783                                 <span class="keywordflow">break</span>;
<a name="l01784"></a>01784                         <span class="keywordflow">case</span> (<a class="code" href="class_rage_pixel_sprite.html">RagePixelSprite</a>.PivotMode.Bottom):
<a name="l01785"></a>01785                                 pivotOffset.x = -ragePixelSprite.GetCurrentRow().newPixelSizeX / 2f;
<a name="l01786"></a>01786                                 pivotOffset.y = 0f;
<a name="l01787"></a>01787                                 <span class="keywordflow">break</span>;
<a name="l01788"></a>01788                         <span class="keywordflow">case</span> (<a class="code" href="class_rage_pixel_sprite.html">RagePixelSprite</a>.PivotMode.Middle):
<a name="l01789"></a>01789                                 pivotOffset.x = -ragePixelSprite.GetCurrentRow().newPixelSizeX / 2f;
<a name="l01790"></a>01790                                 pivotOffset.y = -ragePixelSprite.GetCurrentRow().newPixelSizeY / 2f;
<a name="l01791"></a>01791                                 <span class="keywordflow">break</span>;
<a name="l01792"></a>01792                         }
<a name="l01793"></a>01793 
<a name="l01794"></a>01794                         <span class="keywordflow">break</span>;
<a name="l01795"></a>01795                 <span class="keywordflow">case</span> (Mode.Default):
<a name="l01796"></a>01796                 <span class="keywordflow">case</span> (Mode.Fill):
<a name="l01797"></a>01797                 <span class="keywordflow">case</span> (Mode.Pen):
<a name="l01798"></a>01798                 <span class="keywordflow">case</span> (Mode.Scale):
<a name="l01799"></a>01799                 <span class="keywordflow">case</span> (Mode.Select):
<a name="l01800"></a>01800                         <span class="keywordflow">switch</span>(ragePixelSprite.pivotMode)
<a name="l01801"></a>01801                         {
<a name="l01802"></a>01802                         <span class="keywordflow">case</span> (<a class="code" href="class_rage_pixel_sprite.html">RagePixelSprite</a>.PivotMode.BottomLeft):
<a name="l01803"></a>01803                                 pivotOffset.x = 0f;
<a name="l01804"></a>01804                                 pivotOffset.y = 0f;
<a name="l01805"></a>01805                                 <span class="keywordflow">break</span>;
<a name="l01806"></a>01806                         <span class="keywordflow">case</span> (<a class="code" href="class_rage_pixel_sprite.html">RagePixelSprite</a>.PivotMode.Bottom):
<a name="l01807"></a>01807                                 pivotOffset.x = -ragePixelSprite.pixelSizeX / 2f;
<a name="l01808"></a>01808                                 pivotOffset.y = 0f;
<a name="l01809"></a>01809                                 <span class="keywordflow">break</span>;
<a name="l01810"></a>01810                         <span class="keywordflow">case</span> (<a class="code" href="class_rage_pixel_sprite.html">RagePixelSprite</a>.PivotMode.Middle):
<a name="l01811"></a>01811                                 pivotOffset.x = -ragePixelSprite.pixelSizeX / 2f;
<a name="l01812"></a>01812                                 pivotOffset.y = -ragePixelSprite.pixelSizeY / 2f;
<a name="l01813"></a>01813                                 <span class="keywordflow">break</span>;
<a name="l01814"></a>01814                         }
<a name="l01815"></a>01815                         <span class="keywordflow">break</span>;
<a name="l01816"></a>01816                 }
<a name="l01817"></a>01817                 <span class="keywordflow">return</span> pivotOffset;
<a name="l01818"></a>01818         }
<a name="l01819"></a>01819 
<a name="l01820"></a>01820         <span class="keyword">public</span> Vector3 TexelCoordsToWorld(Texture2D tex, Transform t, <a class="code" href="class_rage_pixel_texel.html">RagePixelTexel</a> texel)
<a name="l01821"></a>01821         {
<a name="l01822"></a>01822                 Vector3 v = <span class="keyword">new</span> Vector3(texel.X, texel.Y, 0f);
<a name="l01823"></a>01823                 <span class="comment">//v.Scale(new Vector3(1f/t.localScale.x,1f/t.localScale.y,1f));</span>
<a name="l01824"></a>01824                 <span class="keywordflow">return</span> t.TransformPoint(v + GetPivotOffset());
<a name="l01825"></a>01825         }
<a name="l01826"></a>01826 
<a name="l01827"></a>01827         <span class="keyword">public</span> Vector3 worldToSceneScreenPoint(Vector3 worldPos)
<a name="l01828"></a>01828         {
<a name="l01829"></a>01829                 Camera sceneCamera = SceneView.lastActiveSceneView.camera;
<a name="l01830"></a>01830                 Vector3 screenPos = sceneCamera.WorldToScreenPoint(worldPos);
<a name="l01831"></a>01831                 <span class="keywordflow">return</span> <span class="keyword">new</span> Vector3(screenPos.x + 1f, -screenPos.y + sceneCamera.pixelHeight + 3f, 0f);
<a name="l01832"></a>01832         }
<a name="l01833"></a>01833 
<a name="l01834"></a>01834         <span class="keyword">public</span> Vector3 sceneScreenToWorldPoint(Vector3 sceneScreenPoint)
<a name="l01835"></a>01835         {
<a name="l01836"></a>01836                 Camera sceneCamera = SceneView.lastActiveSceneView.camera;
<a name="l01837"></a>01837                 <span class="keywordtype">float</span> screenHeight = sceneCamera.orthographicSize * 2f;
<a name="l01838"></a>01838                 <span class="keywordtype">float</span> screenWidth = screenHeight * sceneCamera.aspect;
<a name="l01839"></a>01839 
<a name="l01840"></a>01840                 Vector3 worldPos = <span class="keyword">new</span> Vector3(
<a name="l01841"></a>01841             (sceneScreenPoint.x / sceneCamera.pixelWidth) * screenWidth - screenWidth * 0.5f,
<a name="l01842"></a>01842             ((-(sceneScreenPoint.y) / sceneCamera.pixelHeight) * screenHeight + screenHeight * 0.5f),
<a name="l01843"></a>01843             0f);
<a name="l01844"></a>01844 
<a name="l01845"></a>01845                 worldPos += sceneCamera.transform.position;
<a name="l01846"></a>01846                 worldPos.z = 0f;
<a name="l01847"></a>01847 
<a name="l01848"></a>01848                 <span class="keywordflow">return</span> worldPos;
<a name="l01849"></a>01849         }
<a name="l01850"></a>01850     
<a name="l01851"></a>01851         <span class="keyword">public</span> <span class="keywordtype">void</span> saveTexture()
<a name="l01852"></a>01852         {
<a name="l01853"></a>01853                 RagePixelUtil.SaveSpritesheetTextureToDisk(ragePixelSprite.spriteSheet);
<a name="l01854"></a>01854         }
<a name="l01855"></a>01855 
<a name="l01856"></a>01856         <span class="keyword">public</span> <a class="code" href="class_rage_pixel_bitmap.html">RagePixelBitmap</a> GrabSprite(Rect spriteUV)
<a name="l01857"></a>01857         {
<a name="l01858"></a>01858                 <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="class_rage_pixel_bitmap.html">RagePixelBitmap</a>(
<a name="l01859"></a>01859             ragePixelSprite.spriteSheet.getImage(
<a name="l01860"></a>01860                 ragePixelSprite.GetCurrentRowIndex(),
<a name="l01861"></a>01861                 ragePixelSprite.GetCurrentCellIndex()
<a name="l01862"></a>01862                 ),
<a name="l01863"></a>01863             (<span class="keywordtype">int</span>)(spriteUV.width * spritesheetTexture.width),
<a name="l01864"></a>01864             (<span class="keywordtype">int</span>)(spriteUV.height * spritesheetTexture.height)
<a name="l01865"></a>01865             );
<a name="l01866"></a>01866         }
<a name="l01867"></a>01867 
<a name="l01868"></a>01868         <span class="keyword">public</span> <a class="code" href="class_rage_pixel_bitmap.html">RagePixelBitmap</a> GrabRectFromSpritesheet(<a class="code" href="class_rage_pixel_texel_rect.html">RagePixelTexelRect</a> rect)
<a name="l01869"></a>01869         {
<a name="l01870"></a>01870                 <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="class_rage_pixel_bitmap.html">RagePixelBitmap</a>(
<a name="l01871"></a>01871             ragePixelSprite.spriteSheet.getImage(
<a name="l01872"></a>01872                 ragePixelSprite.GetCurrentRowIndex(), ragePixelSprite.GetCurrentCellIndex(),
<a name="l01873"></a>01873                 rect.X,
<a name="l01874"></a>01874                 rect.Y,
<a name="l01875"></a>01875                 rect.Width(),
<a name="l01876"></a>01876                 rect.Height()
<a name="l01877"></a>01877                 ),
<a name="l01878"></a>01878             rect.Width(),
<a name="l01879"></a>01879             rect.Height()
<a name="l01880"></a>01880             );
<a name="l01881"></a>01881         }
<a name="l01882"></a>01882 
<a name="l01883"></a>01883         <span class="keyword">public</span> <span class="keywordtype">void</span> CutRectInSpritesheet(<a class="code" href="class_rage_pixel_texel_rect.html">RagePixelTexelRect</a> rect, Rect spriteUV)
<a name="l01884"></a>01884         {
<a name="l01885"></a>01885                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> y = rect.Y; y &lt;= rect.Y2; y++)
<a name="l01886"></a>01886                 {
<a name="l01887"></a>01887                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> x = rect.X; x &lt;= rect.X2; x++)
<a name="l01888"></a>01888                         {
<a name="l01889"></a>01889                                 spritesheetTexture.SetPixel(
<a name="l01890"></a>01890                     (<span class="keywordtype">int</span>)(spriteUV.x * spritesheetTexture.width) + x,
<a name="l01891"></a>01891                     (<span class="keywordtype">int</span>)(spriteUV.y * spritesheetTexture.height) + y,
<a name="l01892"></a>01892                     <span class="keyword">new</span> Color(0f, 0f, 0f, 0f)
<a name="l01893"></a>01893                     );
<a name="l01894"></a>01894                         }
<a name="l01895"></a>01895                 }
<a name="l01896"></a>01896         }
<a name="l01897"></a>01897 
<a name="l01898"></a>01898         <span class="keyword">public</span> <span class="keywordtype">void</span> PasteBitmapToSpritesheet(<a class="code" href="class_rage_pixel_texel.html">RagePixelTexel</a> position, Rect spriteUV, <a class="code" href="class_rage_pixel_bitmap.html">RagePixelBitmap</a> bitmap)
<a name="l01899"></a>01899         {
<a name="l01900"></a>01900                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> y = Mathf.Max(position.Y, 0); y &lt; position.Y + bitmap.Height() &amp;&amp; y &lt; (int)(spriteUV.height * spritesheetTexture.height); y++)
<a name="l01901"></a>01901                 {
<a name="l01902"></a>01902                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> x = Mathf.Max(position.X, 0); x &lt; position.X + bitmap.Width() &amp;&amp; x &lt; (int)(spriteUV.width * spritesheetTexture.width); x++)
<a name="l01903"></a>01903                         {
<a name="l01904"></a>01904                                 spritesheetTexture.SetPixel(
<a name="l01905"></a>01905                     (<span class="keywordtype">int</span>)(spriteUV.x * spritesheetTexture.width) + x,
<a name="l01906"></a>01906                     (<span class="keywordtype">int</span>)(spriteUV.y * spritesheetTexture.height) + y,
<a name="l01907"></a>01907                     bitmap.GetPixel(x - position.X, y - position.Y)
<a name="l01908"></a>01908                     );
<a name="l01909"></a>01909                         }
<a name="l01910"></a>01910                 }       
<a name="l01911"></a>01911         }
<a name="l01912"></a>01912 
<a name="l01913"></a>01913         <span class="keyword">public</span> <span class="keywordtype">void</span> PasteBitmapToSpritesheetAlpha(<a class="code" href="class_rage_pixel_texel.html">RagePixelTexel</a> position, Rect spriteUV, <a class="code" href="class_rage_pixel_bitmap.html">RagePixelBitmap</a> bitmap)
<a name="l01914"></a>01914         {
<a name="l01915"></a>01915                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> y = Mathf.Max(position.Y, 0); y &lt; position.Y + bitmap.Height() &amp;&amp; y &lt; (int)(spriteUV.height * spritesheetTexture.height); y++)
<a name="l01916"></a>01916                 {
<a name="l01917"></a>01917                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> x = Mathf.Max(position.X, 0); x &lt; position.X + bitmap.Width() &amp;&amp; x &lt; (int)(spriteUV.width * spritesheetTexture.width); x++)
<a name="l01918"></a>01918                         {
<a name="l01919"></a>01919                                 Color src = bitmap.GetPixel(x - position.X, y - position.Y);
<a name="l01920"></a>01920                                 Color trg = spritesheetTexture.GetPixel((<span class="keywordtype">int</span>)(spriteUV.x * spritesheetTexture.width) + x, (<span class="keywordtype">int</span>)(spriteUV.y * spritesheetTexture.height) + y);
<a name="l01921"></a>01921                 
<a name="l01922"></a>01922                                 spritesheetTexture.SetPixel(
<a name="l01923"></a>01923                     (<span class="keywordtype">int</span>)(spriteUV.x * spritesheetTexture.width) + x,
<a name="l01924"></a>01924                     (<span class="keywordtype">int</span>)(spriteUV.y * spritesheetTexture.height) + y,
<a name="l01925"></a>01925                     src + (1f - src.a) * trg
<a name="l01926"></a>01926                     );
<a name="l01927"></a>01927                         }
<a name="l01928"></a>01928                 }
<a name="l01929"></a>01929         }
<a name="l01930"></a>01930 
<a name="l01931"></a>01931         <span class="keyword">public</span> <span class="keywordtype">void</span> InvokeOnSelectedEvent()
<a name="l01932"></a>01932         {
<a name="l01933"></a>01933                 <span class="keywordflow">if</span>(!justSelected)
<a name="l01934"></a>01934                 {
<a name="l01935"></a>01935                         OnSelected();
<a name="l01936"></a>01936                         justSelected = <span class="keyword">true</span>;
<a name="l01937"></a>01937                 }
<a name="l01938"></a>01938         }
<a name="l01939"></a>01939 
<a name="l01940"></a>01940         <span class="keyword">public</span> Camera GetSceneCamera()
<a name="l01941"></a>01941         {
<a name="l01942"></a>01942                 Camera cam = SceneView.lastActiveSceneView.camera;
<a name="l01943"></a>01943                 <span class="keywordflow">return</span> cam;
<a name="l01944"></a>01944         }
<a name="l01945"></a>01945 
<a name="l01946"></a>01946         <span class="keyword">public</span> <span class="keywordtype">int</span> GetAtlasCellCount(<a class="code" href="class_rage_pixel_sprite_sheet.html">RagePixelSpriteSheet</a>[] spriteSheets, Material atlas)
<a name="l01947"></a>01947         {
<a name="l01948"></a>01948                 <span class="keywordtype">int</span> count = 0;
<a name="l01949"></a>01949 
<a name="l01950"></a>01950                 <span class="keywordflow">foreach</span>(<a class="code" href="class_rage_pixel_sprite_sheet.html">RagePixelSpriteSheet</a> sheet <span class="keywordflow">in</span> spriteSheets)
<a name="l01951"></a>01951                 {
<a name="l01952"></a>01952                         <span class="keywordflow">if</span>(sheet.atlas.Equals(atlas))
<a name="l01953"></a>01953                         {
<a name="l01954"></a>01954                                 <span class="keywordflow">foreach</span>(<a class="code" href="class_rage_pixel_row.html">RagePixelRow</a> row <span class="keywordflow">in</span> sheet.rows)
<a name="l01955"></a>01955                                 {
<a name="l01956"></a>01956                                         count += row.cells.Length;            
<a name="l01957"></a>01957                                 }
<a name="l01958"></a>01958                         }
<a name="l01959"></a>01959                 }
<a name="l01960"></a>01960 
<a name="l01961"></a>01961                 <span class="keywordflow">return</span> count;
<a name="l01962"></a>01962         }
<a name="l01963"></a>01963         
<a name="l01964"></a>01964         <span class="keyword">public</span> <span class="keywordtype">bool</span> SceneCameraFacingCorrectly()
<a name="l01965"></a>01965         {
<a name="l01966"></a>01966                 <span class="keywordflow">if</span>(sceneCamera != null)
<a name="l01967"></a>01967                 {
<a name="l01968"></a>01968                         <span class="keywordflow">if</span>(sceneCamera.transform.forward.z &gt; 0.999999f &amp;&amp; Mathf.Abs(sceneCamera.transform.forward.y) &lt; 0.000001f &amp;&amp; Mathf.Abs(sceneCamera.transform.forward.x) &lt; 0.000001f)
<a name="l01969"></a>01969                         {
<a name="l01970"></a>01970                                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01971"></a>01971                         }
<a name="l01972"></a>01972                         <span class="keywordflow">else</span>
<a name="l01973"></a>01973                         {
<a name="l01974"></a>01974                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01975"></a>01975                         }
<a name="l01976"></a>01976                 }
<a name="l01977"></a>01977                 <span class="keywordflow">else</span>
<a name="l01978"></a>01978                 {
<a name="l01979"></a>01979                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01980"></a>01980                 }
<a name="l01981"></a>01981         }
<a name="l01982"></a>01982 
<a name="l01983"></a>01983         <span class="keyword">public</span> Color GetSceneButtonColor(<span class="keywordtype">bool</span> active)
<a name="l01984"></a>01984         {
<a name="l01985"></a>01985                 <span class="keywordflow">if</span>(active)
<a name="l01986"></a>01986                 {
<a name="l01987"></a>01987                         <span class="keywordflow">return</span> <span class="keyword">new</span> Color(0.8f, 0.925f, 1f, 1f);
<a name="l01988"></a>01988                 }
<a name="l01989"></a>01989                 <span class="keywordflow">else</span>
<a name="l01990"></a>01990                 {
<a name="l01991"></a>01991                         <span class="keywordflow">return</span> <span class="keyword">new</span> Color(1f, 1f, 1f, 0.5f);
<a name="l01992"></a>01992                 }
<a name="l01993"></a>01993         }
<a name="l01994"></a>01994 
<a name="l01995"></a>01995         <span class="keyword">private</span> <span class="keywordtype">int</span> RandomKey()
<a name="l01996"></a>01996         {
<a name="l01997"></a>01997                 <span class="keywordtype">int</span> val = (int)UnityEngine.Random.Range(<span class="keywordtype">int</span>.MinValue, <span class="keywordtype">int</span>.MaxValue);
<a name="l01998"></a>01998                 <span class="keywordflow">if</span>(val == 0)
<a name="l01999"></a>01999                 {
<a name="l02000"></a>02000                         val++;
<a name="l02001"></a>02001                 }
<a name="l02002"></a>02002                 <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)UnityEngine.Random.Range(<span class="keywordtype">int</span>.MinValue, <span class="keywordtype">int</span>.MaxValue);
<a name="l02003"></a>02003         }
<a name="l02004"></a>02004 }
</pre></div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Tue May 8 2012 20:54:20 for RagePixel by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.0
</small></address>

</body>
</html>
